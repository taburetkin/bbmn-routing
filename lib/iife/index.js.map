{"version":3,"file":"index.js","sources":["router/build-route-context.js","router/action-context.js","router/process-callback.js","route-error-handler/index.js","router/router.js","history/api.js","history/watcher.js","pages/page-router.js","pages/routes-mixin.js","pages/page.js","pages/paged-app.js"],"sourcesContent":["import _ from 'underscore';\r\nimport { betterResult as result } from 'bbmn-utils';\r\n\r\nfunction get(router, opts = {}, key, update){\r\n\t\r\n\tlet value = result(opts, key, { context: router, args:[ router ] });\r\n\tif(value == null) {\r\n\t\tvalue = router.getOption(key, {args: [ router ]});\r\n\t\tif(update)\r\n\t\t\topts[key] = value;\r\n\t}\r\n\treturn value;\t\t\r\n}\r\n\r\n// converts route method arguments to plain object;\r\n// _normalizeRegisterRouteArguments\r\n// { route, rawRoute, callback, name }\r\nexport default function routeArgumentsToObject(router, route, name, callback, opts = {}){\r\n\r\n\tlet context = {};\r\n\r\n\tif(_.isObject(route)){\r\n\t\tcontext = route;\r\n\r\n\t\t//then second argument is probably options;\r\n\t\t_.extend(opts, name);\r\n\r\n\t} else if (_.isFunction(name)) {\r\n\t\t_.extend(context, { route, callback: name, name: _.uniqueId('routerAction') });\r\n\t} else {\r\n\t\t_.extend(context, { route, name, callback });\r\n\t}\r\n\r\n\tlet isRouterHoldsActions = get(router, opts, 'isRouterHoldsActions', true);\r\n\r\n\r\n\t// last chance to get callback from router instance by name\r\n\t// this behavior can be disabled through `isRouterHoldsActions` options\r\n\tif(!_.isFunction(context.callback) && isRouterHoldsActions && _.isFunction(router[context.name])) {\r\n\r\n\t\tcontext.callback = router[context.name];\r\n\r\n\t}\r\n\r\n\t//store original route\r\n\tcontext.rawRoute = context.route;\r\n\r\n\t!context.name && (context.name = _.uniqueId('routerAction'));\r\n\r\n\t//converts route to RegExp pattern\r\n\tif (!_.isRegExp(context.route)) context.route = router._routeToRegExp(context.route);\r\n\r\n\t// by default backbone router wraps every callback with own wrapper\r\n\t// which in turn call actual callback with correct arguments on route\r\n\t// this callback was inlined and can not be overrided, so now its possible\t\r\n\tcontext.callbackWrapper = _.bind(router._processCallback, router, context);\r\n\r\n\treturn context;\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\n\r\nexport function createActionContext(router, routeContext, fragment, options = {}) {\r\n\r\n\tlet rawArgs = router._extractParameters(routeContext.route, fragment);\r\n\r\n\tlet result = _.extend({}, routeContext, { fragment, rawArgs }, options, { options });\r\n\r\n\tlet args = rawArgs.slice(0);\r\n\tlet queryString = args.pop();\r\n\r\n\t_.extend(result, { qs: prepareActionQueryString(router, queryString) });\r\n\t_.extend(result, { args: prepareActionArguments(routeContext.rawRoute, args) });\r\n\r\n\tif (result.routeType == null) {\r\n\t\tresult.routeType = 'route';\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction prepareActionQueryString(router, queryString){\r\n\tif(_.isString(queryString))\r\n\t\treturn router.queryStringParser(queryString);\r\n\telse\r\n\t\treturn {};\r\n}\r\n\r\nfunction prepareActionArguments(rawRoute, args){\r\n\r\n\tlet params = rawRoute.match(/:([^/|)]+)/g) || [];\r\n\t\r\n\tlet res = {};\r\n\t_(params).each((name, index) => {\r\n\t\tname = name.substring(1);\r\n\t\t\r\n\t\tif(args == null) return;\r\n\r\n\t\tif(name in res && _.isArray(res[name]))\r\n\t\t\tres[name].push(args[index]);\r\n\t\telse if(name in res && !_.isArray(res[name]))\r\n\t\t\tres[name] = [res[name]].concat(args[index]);\r\n\t\telse\r\n\t\t\tres[name] = args[index];\r\n\t});\r\n\treturn res;\r\n}\r\n","import _ from 'underscore';\r\nimport { history } from 'bbmn-core';\r\n\r\nfunction toPromise(arg, resolve = true){\r\n\tif (arg instanceof Promise || (arg && _.isFunction(arg.then)))\r\n\t\treturn arg;\r\n\telse if (arg instanceof Error)\r\n\t\treturn Promise.reject(arg);\r\n\telse\r\n\t\treturn resolve \r\n\t\t\t? Promise.resolve(arg) \r\n\t\t\t: Promise.reject(arg);\r\n}\r\n\r\n\r\nfunction getCallbackFunction(callback, executeResult)\r\n{\r\n\treturn (...args) => {\r\n\t\ttry {\r\n\t\t\texecuteResult.value = callback && callback(...args);\r\n\t\t} catch(exception) {\r\n\t\t\texecuteResult.value = exception;\r\n\t\t}\r\n\t\texecuteResult.promise = toPromise(executeResult.value);\r\n\t\treturn executeResult.value;\r\n\t};\r\n}\r\n\r\n\r\nexport function processCallback(router, actionContext, routeType){\t\r\n\t\r\n\tlet args = router.getOption('classicMode') \r\n\t\t? actionContext.rawArgs || [] \r\n\t\t: [ actionContext ];\r\n\r\n\tlet asPromise = router.getOption('callbackAsPromises');\r\n\tlet executeResult = {};\r\n\tlet callback = getCallbackFunction(actionContext.callback, executeResult, asPromise);\r\n\r\n\r\n\t\r\n\trouter.triggerEvent('before:' + routeType, actionContext);\r\n\r\n\tlet shouldTriggerEvent = router.execute(callback, args);\r\n\tif (shouldTriggerEvent !== false) {\r\n\t\trouter.triggerEvent(routeType, actionContext);\r\n\t\tif(routeType == 'route' || routeType == 'backroute')\r\n\t\t\trouter.lastAttempt = actionContext;\r\n\t\thistory.actionContext = actionContext;\r\n\t}\r\n\r\n\texecuteResult.promise.then(\r\n\t\t(arg) => {\r\n\t\t\trouter.triggerEvent('after:'+routeType, actionContext);\r\n\t\t\treturn arg;\r\n\t\t},\r\n\t\t(error) => {\r\n\t\t\trouter.triggerEvent('error:' + routeType, error, actionContext);\r\n\t\t\trouter.handleError(error, actionContext);\r\n\t\t}\r\n\t);\r\n\r\n\treturn executeResult.value;\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n//import $ from 'jquery';\r\n\r\nexport default {\r\n\thandlers: {\r\n\t\t'js:error'(error){\r\n\t\t\tthrow error;\r\n\t\t},\r\n\t},\r\n\thandle(error, context, args){\r\n\r\n\t\tlet handlers = this._getHandleContext(error, context, args) || {};\r\n\t\treturn _(handlers).some((options, key) => this.applyHandler(key, options));\r\n\r\n\t},\r\n\tapplyHandler(key, options = {}){\r\n\r\n\t\tlet handler = this.getHandler(key, options);\r\n\t\tif (!handler) return;\r\n\t\tlet { context, args } = options;\r\n\t\treturn handler.apply(context, args);\r\n\r\n\t},\r\n\tgetHandler(key){\r\n\t\tif(_.isFunction(this.handlers[key]))\r\n\t\t\treturn this.handlers[key];\r\n\t},\r\n\tsetHandler(key, handler, bindTo){\r\n\t\tif(!_.isString(key) || key === '')\r\n\t\t\tthrow new Error('setHandler first argument must be a non empty string');\r\n\r\n\t\tif (!_.isFunction(handler)) {\r\n\t\t\tdelete this.handlers[key];\r\n\t\t} else {\r\n\t\t\tif (bindTo) {\r\n\t\t\t\thandler = handler.bind(bindTo);\r\n\t\t\t}\r\n\t\t\tthis.handlers[key] = handler;\r\n\t\t}\r\n\t},\r\n\tsetHandlers(hash, bindTo){\r\n\t\tlet nullable = hash === null;\r\n\t\tlet items = nullable && this.handlers || hash;\r\n\t\tif(!_.isObject(items)) return;\r\n\t\t_(items).each((handler, key) => this.setHandler(key, nullable || handler, bindTo));\r\n\t},\r\n\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\t_getHandleContext(error, context, args = []){\r\n\r\n\t\tif (_.isArray(error)) {\r\n\t\t\treturn _(error).reduce((memo, item) => _.extend(memo, this._getHandleContext(item, context, args)), {});\r\n\t\t}\r\n\r\n\t\tif(_.isFunction(this.getHandleContext)) {\r\n\t\t\tlet custom = this.getHandleContext(error, context, args);\r\n\t\t\tif(custom != null) return custom;\r\n\t\t}\r\n\r\n\t\tif (error instanceof Error) {\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'js:error': { context, args } };\r\n\t\t}\r\n\t\telse if(_.isString(error)) {\r\n\t\t\treturn { [error]: { context, args } };\r\n\t\t}\r\n\t\telse if(error instanceof $.Deferred().constructor){\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'jq:xhr': { context, args }};\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// provide your own arguments processor\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\tgetHandleContext: undefined,\r\n\r\n};\r\n","import _ from 'underscore';\r\nimport {  getOption, triggerMethod, paramsToObject } from 'bbmn-utils';\r\nimport { Router as BbRouter, history } from 'bbmn-core';\r\n\r\n//import paramStringToObject from '../../../utils/params-to-object/index.js';\r\n//import { Backbone, Router as BbRouter } from '../../../vendors/backbone.js';\r\n\r\nimport buildRouteContextFromArguments from './build-route-context.js';\r\n\r\nimport  { createActionContext } from './action-context.js';\r\nimport { processCallback } from './process-callback.js';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\n\r\n\r\nconst Router = BbRouter.extend({\r\n\r\n\r\n\t// for migrating from Mn.AppRoute\r\n\t// set to true. it will populate routes from { controller, appRoutes } structure.\r\n\tisMarionetteStyle: false,\r\n\r\n\t// by default Backbone.Router tries to lookup callback in router instance by name `callback = this[name]` if there is no callback provided\r\n\t// its recomend to turn this feature to false\r\n\t// default value is true for Backbone.Router compatability\r\n\tisRouterHoldsActions : true,\r\n\r\n\t// by default Backbone.Router `route` method returns router itself instead of just created routeContext for chaining purposes.\r\n\t// you can change this behavior turning this feature to false\r\n\tisRouteChaining: true,\r\n\r\n\t//in classic mode actions receive argument array\r\n\t//if you need actionContext instead turn this option to false\r\n\tclassicMode: true,\r\n\r\n\tconstructor(options = {}){\r\n\t\t\r\n\t\tthis.options = _.extend({}, _.result(this, 'options'), options);\r\n\r\n\t\tBbRouter.apply(this, arguments);\r\n\r\n\r\n\t},\r\n\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\ttriggerMethod,\r\n\t/*\r\n\r\n\t\tinitialize methods\r\n\t\t\"when a router initialized\"\r\n\r\n\t*/\r\n\r\n\t//by default router expects that routes will result in { route, callback } hash\r\n\t//we are extending this to provide more flexibility\r\n\t// - overrided\r\n\t_bindRoutes: function() {\r\n\t\t\r\n\t\tlet routes = this.getInitRoutes();\r\n\t\tif(!_.size(routes)) return;\r\n\t\tthis.addRoutes(routes);\r\n\r\n\t},\r\n\tgetInitRoutes(){\r\n\t\tlet routes;\r\n\t\tif(this.getOption('isMarionetteStyle')) {\r\n\t\t\tlet controller = this.getOption('controller') || {};\r\n\t\t\tlet approutes = this.getOption('appRoutes') || {};\r\n\t\t\troutes = _(approutes).map((name, route) => ({ \r\n\t\t\t\troute, name, \r\n\t\t\t\tcallback: controller[name] \r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\troutes = this.getOption('routes');\r\n\t\t}\r\n\t\treturn routes;\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tmanipulating routes\r\n\t\tadding\r\n\t*/\r\n\r\n\t// refactored original route method\r\n\t// chain:true by default is for supporting default behavior\r\n\t// routerHoldsActions: true - backbone router tries to get callback from router itself if there is no callback provided. \r\n\t// this options allow to support this behavior, but its recomended not to hold action inside router instance\r\n\t// - overrided\r\n\troute(route, name, callback, opts = {}){\r\n\t\t\r\n\t\t//normalizing passed arguments and putting them into a context object\r\n\t\t//refactored from original route\r\n\t\t// let context = this._normalizeRegisterRouteArguments(route, name, callback, opts);\r\n\r\n\t\t// //extends context with result of `mergeWithRegisterRouteContext`\r\n\t\t// this._normalizeRegisterRouteContext(context);\r\n\r\n\t\t// //wrapping provided callback \r\n\t\t// this._normalizeRegisterRouteCallback(context);\r\n\r\n\t\tlet context = this._buildRouteContext(route, name, callback, opts);\r\n\r\n\t\t//refactored for providing possibility to override\r\n\t\t//at this point context should be almost ready\r\n\t\tthis.registerRouteContext(context);\r\n\r\n\t\tthis._storeCreatedContext(context, opts);\r\n\r\n\t\treturn opts.isRouteChaining === true \r\n\t\t\t? this \r\n\t\t\t: context;\r\n\r\n\t},\r\n\r\n\t// provide more semantic alias for route\r\n\taddRoute(route, name, callback, opts = {}){\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet context = this.route(route, name, callback, opts);\r\n\t\treturn context;\r\n\t},\r\n\r\n\t//process many routes at once\r\n\t//accepts object { name, routeContext | handler }\r\n\t// or array of routeContexts\r\n\taddRoutes(routes, opts = {}){\r\n\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet normalized = _(routes)\r\n\t\t\t.chain()\r\n\t\t\t.map((value, key) => this._normalizeRoutes(value, key))\r\n\t\t\t.filter(f => _.isObject(f))\r\n\t\t\t.value();\r\n\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tnormalized.reverse();\r\n\r\n\t\tlet registered = _(normalized).map(\r\n\t\t\troute => route && \r\n\t\t\tthis.addRoute(route, _.extend({ massAdd:true }, opts))\r\n\t\t); \r\n\t\t\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tregistered.reverse();\r\n\r\n\t\t_(registered).each((c) => this._storeCreatedContext(c));\r\n\t\t\r\n\t\treturn registered;\r\n\t},\r\n\r\n\t// internal method called by `addRoutes` to normalize provided data\r\n\t_normalizeRoutes(value, key){\r\n\t\t//let route, name, callback;\r\n\t\tlet context;\r\n\t\tif (_.isString(value)) {\r\n\t\t\tcontext = { \r\n\t\t\t\troute: key, \r\n\t\t\t\tname: value, \r\n\t\t\t};\r\n\t\t}\r\n\t\telse if(_.isFunction(value)){\r\n\t\t\tcontext = { route:key, callback:value };\r\n\t\t}else if(_.isObject(value)){\r\n\t\t\tcontext = _.clone(value);\r\n\t\t\tif(!_.has(context, 'route'))\r\n\t\t\t\tcontext.route = key;\r\n\t\t\telse if(_.has(context, 'route') && !_.has(context, 'name'))\r\n\t\t\t\tcontext.name = key;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_buildRouteContext(route, name, callback, opts) {\r\n\r\n\t\tlet context = buildRouteContextFromArguments(this, route, name, callback, opts);\r\n\r\n\t\treturn this.buildRouteContext(context);\r\n\t},\r\n\r\n\t//override this method if you need more information in route context\r\n\t// should return object wich will be merged with default context\r\n\t// be aware of providing reserved properties: route, name, callback\r\n\t// this will override context defaults\r\n\tbuildRouteContext: context => context,\r\n\r\n\r\n\t//finally, putting handler to the backbone.history.handlers\r\n\tregisterRouteContext(context){\r\n\t\thistory.route(context.route, context.callbackWrapper, context);\r\n\t},\r\n\r\n\t//store registered context for further use\r\n\t_storeCreatedContext(context, opts = {}){\r\n\t\tthis.routeContexts || (this.routeContexts = {});\r\n\t\tif(!opts.massAdd)\r\n\t\t\tthis.routeContexts[context.name] = context;\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\t/*\r\n\t\r\n\t\tprocess route methods\t\t\r\n\t\t\"when route happens\"\r\n\r\n\t*/\r\n\r\n\t//inner route handler\r\n\t//preparing actionContext and calls public processCallback\r\n\t_processCallback (routeContext, fragment, options = {}) {\r\n\t\tlet actionContext = createActionContext(this, routeContext, fragment, options);\r\n\t\tactionContext.restart = () => actionContext.callbackWrapper(fragment, options);\r\n\t\tlet result = this.processCallback(actionContext, actionContext.routeType, options);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t//by default behave as original router\r\n\t//override this method to process action by your own\r\n\tprocessCallback(actionContext, routeType){\r\n\r\n\t\treturn processCallback(this, actionContext, routeType);\r\n\r\n\t},\r\n\r\n\thandleError(error, action){\t\t\r\n\t\terrorHandler.handle(error, this, [action]);\r\n\t},\r\n\r\n\t//just triggers appropriate events\r\n\t// triggerRouteEvents(context, event, name, ...args) {\r\n\t// \tif (event == 'route') {\r\n\t// \t\tthis.lastActionContext = context;\r\n\t// \t}\r\n\t// \tthis.trigger(`${event}:${name}`, ...args);\r\n\t// \tthis.trigger(event, name, ...args);\r\n\t// \tBackbone.history.trigger(event, this, name, ...args);\r\n\t// },\r\n\r\n\ttriggerEvent(event, context){\r\n\t\tthis.trigger(event, context);\r\n\t\thistory.trigger(event, context);\r\n\t},\r\n\r\n\r\n\r\n\r\n\t//converts string to object\r\n\t//default implementation, can be overriden by user\r\n\tqueryStringParserOptions:{ complex: true },\r\n\tqueryStringParser(string, opts){\r\n\t\tlet options = _.extend({}, this.getOption('queryStringParserOptions'), opts);\r\n\t\treturn paramsToObject(string, options);\r\n\t},\t\r\n\r\n\t// navigate(...args){\r\n\t// \thistoryNavigate(...args);\r\n\t// \treturn this;\r\n\t// },\r\n\r\n\t_routeToRegExp(route) {\r\n\r\n\t\tvar optionalParam = /\\((.*?)\\)/g;\r\n\t\tvar namedParam    = /(\\(\\?)?:\\w+/g;\r\n\t\tvar splatParam    = /\\*\\w+/g;\r\n\t\tvar escapeRegExp  = /[-{}[]+?.,\\\\\\^$|#\\s]/g;\r\n\r\n\t\troute = route.replace(escapeRegExp, '\\\\$&')\r\n\t\t\t.replace(optionalParam, '(?:$1)?')\r\n\t\t\t.replace(namedParam, function(match, optional) {\r\n\t\t\t\treturn optional ? match : '([^/?]+)';\r\n\t\t\t})\r\n\t\t\t.replace(splatParam, '([^?]*?)');\r\n\t\tlet flags = this.getOption('routeCaseInsensitive') ? 'i' : '';\r\n\t\treturn new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$', flags);\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tSome API methods\r\n\t*/\r\n\r\n\tgetContextByFragment(fragment)\t{\r\n\t\tif(!_.isString(fragment)) return;\r\n\t\t//let contexts = this.routeContexts;\r\n\t\t//console.log('Router contexts', contexts);\r\n\t\tlet result = _(this.routeContexts).find((cntx) => cntx.route.test(fragment));\r\n\t\treturn result;\r\n\t}\r\n\r\n\r\n});\r\n\r\nexport default Router;\r\n","import _ from 'underscore';\r\nimport { history } from 'bbmn-core';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\nconst pathStripper = /#.*$/;\r\n\r\n\r\n\r\n\r\n\r\nconst historyApi = {\r\n\tdecodeFragment(fragment){\r\n\t\tfragment = history.getFragment(fragment || '');\r\n\t\tfragment = fragment.replace(pathStripper, '');\r\n\t\treturn history.decodeFragment(fragment);\r\n\t},\r\n\t// supports passing options to the callback\r\n\t// by using new version of loadUrl\t\r\n\tnavigate(fragment, opts){\r\n\t\r\n\t\tlet options = opts === true ? { trigger: true }\r\n\t\t\t: _.isObject(opts) ? _.clone(opts)\r\n\t\t\t\t: {};\r\n\t\r\n\t\tlet { trigger } = options;\t\t\t\r\n\t\toptions.trigger = false;\r\n\r\n\t\tlet decodedFragment = this.decodeFragment(fragment);\r\n\t\tif (history.fragment == decodedFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\thistory.navigate(fragment, options);\r\n\t\r\n\t\tif (trigger) {\r\n\t\t\treturn historyApi.loadUrl(fragment, opts);\r\n\t\t}\r\n\t\r\n\t},\r\n\r\n\texecute(fragment, opts){\r\n\t\t//fragment = history.fragment = history.getFragment(fragment);\r\n\t\tfragment = history.getFragment(fragment);\r\n\r\n\t\tlet executed = historyApi.executeHandler(fragment, opts);\r\n\t\tif (!executed) {\r\n\t\t\terrorHandler.handle('not:found', opts.context, [fragment]);\r\n\t\t}\r\n\t\treturn executed;\r\n\t},\r\n\r\n\t// original loadUrl does not pass options to the callback\r\n\t// and this one does\r\n\tloadUrl(fragment, opts = {}) {\r\n\r\n\t\t// If the root doesn't match, no routes can match either.\r\n\t\tif (!history.matchRoot()) return false;\r\n\t\treturn historyApi.execute(fragment, opts);\r\n\r\n\t\t// fragment = history.fragment = history.getFragment(fragment);\r\n\r\n\t\t// let executed = historyApi.executeHandler(fragment, opts);\r\n\t\t// if (!executed) {\r\n\t\t// \terrorHandler.handle('not:found', opts.context, [fragment]);\r\n\t\t// }\r\n\t\t// return executed;\r\n\t},\r\n\r\n\t// default test handler\r\n\t//TODO: think about constraints check\r\n\ttestHandler(handler, fragment){\r\n\t\treturn handler.route.test(fragment);\r\n\t},\r\n\r\n\t//also accepts test function, if you wish test handlers by your own\r\n\tfindHandler(fragment, customTest){\r\n\t\tlet test = _.isFunction(customTest) ? customTest : historyApi.testHandler;\r\n\t\tfragment = history.getFragment(fragment);\r\n\t\treturn _.filter(history.handlers || [], handler => test(handler, fragment))[0];\r\n\t},\r\n\r\n\texecuteHandler(fragment, opts = {}, resultContext = {}) {\r\n\t\t\r\n\t\tlet handler = historyApi.findHandler(fragment, opts.testHandler);\r\n\t\t\r\n\t\thandler && (resultContext.value = handler.callback(fragment, opts));\r\n\r\n\t\treturn !!handler;\r\n\t},\r\n\t// this start replaces native history loadUrl and test handler\r\n\tstart(options){\r\n\r\n\t\tif(history.loadUrl !== historyApi.loadUrl)\r\n\t\t\thistory.loadUrl = historyApi.loadUrl;\r\n\t\r\n\t\tlet result = history.start(options);\r\n\r\n\t\treturn result;\r\n\t},\r\n\tisStarted(){\r\n\t\treturn !!history.started;\r\n\t},\r\n\tgetUrlPath(){\r\n\t\treturn history.fragment.split('?')[0];\r\n\t},\r\n\tchangeUrlQueryString(qs){\r\n\t\tlet url = this.getUrlPath();\r\n\t\tif(qs){\r\n\t\t\turl = [url, qs].join('?');\r\n\t\t}\r\n\t\treturn this.navigate(url, { trigger: false });\r\n\t}\r\n};\r\n\r\nexport default historyApi;\r\n","import _ from 'underscore';\r\nimport { history, Events, BaseClass }  from 'bbmn-core';\r\nimport { mix } from 'bbmn-utils';\r\nimport historyApi from './api';\r\n\r\nconst Watcher = mix(BaseClass).with(Events).extend({\r\n\tconstructor(){\r\n\t\tBaseClass.apply(this, arguments);\r\n\t\tthis.isWatching = false;\r\n\t\tthis.entries = [];\r\n\t},\r\n\tstart(){\r\n\t\tif (this.isWatching) return;\r\n\t\tthis.isWatching = true;\r\n\t\tthis.listenTo(history, 'route', this.onRoute);\r\n\t\tthis.listenTo(history, 'backroute', this.onBackRoute);\r\n\t},\r\n\tstop(){\r\n\t\tthis.stopListening(history);\r\n\t\tthis.entries.length = 0;\r\n\t\tthis.isWatching = false;\r\n\t},\r\n\tisActionContext: cntx => _.isObject(cntx) && _.isString(cntx.fragment),\r\n\thasElements(){\r\n\t\treturn this.entries.length > 0;\r\n\t},\r\n\tcanGoBack(){\r\n\t\treturn this.hasElements();\r\n\t},\r\n\tonRoute(actionContext){\r\n\r\n\t\tif(!this.isActionContext(actionContext))\r\n\t\t\treturn;\r\n\r\n\t\tif (this.isActionContext(this.lastElement)) {\r\n\t\t\tthis.entries.push(this.lastElement);\r\n\t\t}\r\n\t\tthis.lastElement = actionContext;\r\n\r\n\t},\r\n\tonBackRoute(actionContext){\r\n\t\tif(!this.isActionContext(actionContext) || !this.isActionContext(actionContext.gobackContext))\r\n\t\t\treturn;\r\n\r\n\t\tlet lookFor = actionContext.gobackContext;\r\n\t\tlet index = this.entries.indexOf(lookFor);\r\n\t\tif (index >= 0) {\r\n\t\t\tthis.entries = this.entries.slice(0, index);\r\n\t\t\tthis.lastElement = lookFor;\r\n\t\t}\r\n\r\n\t},\r\n\tgoBack(){\r\n\t\tif (!this.canGoBack()) return;\r\n\t\tlet last = _.last(this.entries);\r\n\t\thistoryApi.navigate(last.fragment, { trigger: true, routeType: 'backroute', gobackContext: last });\r\n\t},\r\n});\r\n\r\nexport default new Watcher();\r\n","import _ from 'underscore';\r\nimport { Process } from 'bbmn-components';\r\nimport BaseRouter from '../router/router.js';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\nexport default BaseRouter.extend({\r\n\t\r\n\tclassicMode:false,\r\n\tisRouterHoldsActions : false,\r\n\tisRouteChaining: false,\t\r\n\tcallbackAsPromises: true,\r\n\trouteCaseInsensitive: true,\r\n\r\n\tsetTitleOnPageStart : true,\r\n\r\n\tregisterPageRoutes(page){\r\n\t\tlet contexts = page.getRoutesContexts({ reverse: true });\r\n\t\t_.each(contexts, context => {\r\n\t\t\tlet callback = (...args) => {\r\n\t\t\t\treturn this.startPage(page, ...args);\r\n\t\t\t};\r\n\t\t\tthis.addRoute(context.route, context.name, callback);\r\n\t\t});\r\n\t},\r\n\r\n\thandleError(process, action){\r\n\t\tlet args, error;\r\n\r\n\t\tif(process instanceof Process) {\r\n\t\t\targs = [].slice.call(process.errors) ;\r\n\t\t\terror = args.shift();\r\n\t\t\targs.push(action);\r\n\t\t} else {\r\n\t\t\terror = process;\r\n\t\t\targs = [action];\r\n\t\t}\r\n\r\n\t\terrorHandler.handle(error, this, args);\r\n\r\n\t},\r\n\tstartPage(page, ...args){\r\n\t\treturn this._beforePageStart(page)\r\n\t\t\t.then(() => page.start(...args))\r\n\t\t\t.then(() => this._afterPageStart(page, ...args));\r\n\t},\r\n\r\n\t_beforePageStart(){\r\n\t\tthis.beforePageStart();\r\n\t\tif (this.previousPage && this.previousPage.isStarted())\r\n\t\t\treturn this.previousPage.stop();\r\n\t\telse\r\n\t\t\treturn Promise.resolve();\r\n\t},\r\n\tbeforePageStart(){},\r\n\r\n\t_afterPageStart(page){\r\n\t\tthis.previousPage = page;\r\n\t\tthis.afterPageStart(page);\r\n\t\tthis._setPageTitle(page);\r\n\t},\r\n\tafterPageStart(){},\r\n\t_setPageTitle(page){\r\n\t\tif(!this.getOption('setTitleOnPageStart')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet title = page.getTitle();\r\n\t\tthis.setPageTitle(title, page);\r\n\t},\r\n\t\r\n\t//implement your set title logic here\r\n\t//accepts: title, page\r\n\tsetPageTitle(title){\r\n\t\tdocument.title = title;\r\n\t},\r\n\trestartLastAttempt(){\r\n\t\tif(this.lastAttempt)\r\n\t\t\treturn this.lastAttempt.restart();\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport PageRouter from './page-router.js';\r\nimport { comparator } from 'bbmn-utils';\r\n\r\nexport default {\r\n\tinitializeRoutes(){\r\n\t\tif (this.initializeRouter()) {\r\n\t\t\tthis._buildRoutesContexts();\r\n\t\t}\r\n\t},\r\n\tinitializeRouter(){\t\t\r\n\t\tif(this.getOption('shouldCreateRouter') && !this.router) {\r\n\t\t\tthis.router = this._createRouter();\r\n\t\t\tthis._shouldRegisterAllRoutes = true;\r\n\t\t}\r\n\r\n\t\tif(this.getOption('shouldRegisterAllRoutes')) {\r\n\t\t\tthis._shouldRegisterAllRoutes = true;\r\n\t\t}\r\n\r\n\t\treturn !!this.router;\r\n\t},\r\n\t_createRouter(){\r\n\t\tlet Router = this.getOption('Router') || PageRouter;\r\n\t\tlet options = _.extend({}, this.getOption('routerOptions'));\r\n\t\treturn new Router(options);\r\n\t},\r\n\tregisterAllRoutes(){\r\n\t\tif(!this._shouldRegisterAllRoutes) return;\r\n\r\n\t\tlet pages = this.getAllChildren({ reverse: true, includeSelf: true, force: true });\r\n\t\t\r\n\t\tlet router = this.router;\r\n\t\t_(pages).each(page => router.registerPageRoutes(page));\r\n\t\t\r\n\t},\r\n\t_buildRoutesContexts(){\r\n\t\tlet routes = this.getOption('routes', {args: [this]});\r\n\t\tif (routes == null) return;\r\n\t\tif(_.isString(routes))\r\n\t\t\troutes = [routes];\r\n\r\n\t\tlet result = [];\r\n\t\tlet config = this.getRoutesConfig();\r\n\t\t_(routes).each((route, index) => {\r\n\t\t\tlet context = this._normalizeRoutesContextRoute(route, index, config);\r\n\t\t\t_.isObject(context) && (result.push(context));\r\n\t\t});\r\n\t\tthis.routesContext = result;\r\n\t\treturn this.routesContext;\r\n\t},\r\n\t_normalizeRoutesContextRoute(arg, index, config = {}){\r\n\t\tif(arguments.length < 2){\r\n\t\t\tconfig = this.getRoutesConfig();\r\n\t\t}\r\n\t\tlet context = { page: this };\r\n\t\tif(arg == null)\r\n\t\t\treturn;\r\n\t\tif (_.isString(arg)) {\r\n\t\t\t_.extend(context, {route: arg, rawRoute: arg });\r\n\t\t} else if(_.isFunction(arg)) {\r\n\t\t\targ = arg.call(this, this, index);\r\n\t\t\treturn this._normalizeRoutesContextRoute(arg, index);\r\n\t\t} else {\r\n\t\t\t_.extend(context, arg);\r\n\t\t}\r\n\t\tlet name = (_.isString(index) && index) || context.name || context.route || _.uniqueId('route');\r\n\t\tcontext.name = name;\r\n\r\n\t\tif(_.isNumber(index) && context.order == null)\r\n\t\t\tcontext.order = index;\r\n\r\n\t\tif (!context.rawRoute)\r\n\t\t\tcontext.rawRoute = context.route;\r\n\t\t\t\t\r\n\t\tif(config.relative && config.parentContext && config.parentContext.route)\r\n\t\t\tcontext.route = config.parentContext.route + '/' + context.route;\r\n\r\n\t\tcontext.getUrl = function(data = {}) {\r\n\t\t\treturn this.route.replace(/:([^/?]+)/, (found, group) => {\r\n\t\t\t\treturn data[group];\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\treturn context;\r\n\t},\r\n\tgetRoutesConfig(){\r\n\t\tlet config = _.extend({ \r\n\t\t\trelative: this.getOption('relativeRoutes', {args: [this]}),\r\n\t\t\tparent: this.parent,\r\n\t\t\tparentContext: this.parent && _.isFunction(this.parent.getMainRouteContext) && this.parent.getMainRouteContext()\r\n\t\t}, this.getOption('routesConfig', {args: [this]}));\r\n\t\t\r\n\t\treturn config;\r\n\t},\r\n\tgetRoutesContexts(opts = {}){\r\n\t\tlet { clone, reverse } = opts;\r\n\t\tlet result = this.routesContext || [];\r\n\t\tif (clone || reverse) result = [].slice.call(result);\r\n\t\tif (reverse) result.reverse();\r\n\t\treturn result;\r\n\t},\r\n\r\n\tgetMainRouteContext(){\r\n\r\n\t\tif(this.mainRouteContext) return this.mainRouteContext;\r\n\t\tthis.mainRouteContext = _(this.getRoutesContexts())\r\n\t\t\t.chain()\r\n\t\t\t.sortBy((a,b) => comparator([ [b,a, c => c.main], [a,b, c => c.order] ]))\r\n\t\t\t.take(1)\r\n\t\t\t.value()[0];\r\n\r\n\t\treturn this.mainRouteContext;\r\n\t}\r\n};\r\n","import _ from 'underscore';\r\nimport { MnObject } from 'bbmn-core';\r\nimport { mix, getOption, buildViewByKey } from 'bbmn-utils';\r\nimport { startableMixin }  from 'bbmn-components';\r\n\r\nimport { childrenableMixin } from 'bbmn-mixins';\r\nimport RoutesMixin from './routes-mixin.js';\r\n\r\n\r\n\r\n\r\nconst BasePage = mix(MnObject).with(childrenableMixin, startableMixin, RoutesMixin);\r\n\r\nexport default BasePage.extend({\r\n\tconstructor(opts = {}){\r\n\t\tBasePage.apply(this, arguments);\r\n\r\n\t\t//root and parent is childrenable options\r\n\t\tthis.mergeOptions(opts, ['app','router','canNotStart','onStart','onBeginStart', 'onBeforeStart', 'onEndStart', 'onStop', 'onBeginStop', 'onBeforeStop', 'onEndStop']);\r\n\r\n\t\t// resides in routes-mixin\r\n\t\tthis.initializeRoutes();\r\n\r\n\t\t// resides in ChildrenableMixin\r\n\t\tthis.initializeChildren();\r\n\t\t\r\n\t\t// resides in routes-mixin\r\n\t\tthis.registerAllRoutes();\r\n\r\n\t\tthis.initializeEvents();\r\n\t},\r\n\tgetOption(...args){\r\n\t\treturn getOption(this, ...args);\r\n\t},\r\n\tgetLabel(data){\r\n\t\tlet result = this.getOption('label', { args: [this, data]});\r\n\t\treturn result;\r\n\t},\r\n\tgetTitle(data){\r\n\t\tlet result = this.getOption('title', { args: [this, data]});\r\n\t\treturn result || this.getLabel(data);\r\n\t},\r\n\tgetMenuLabel(data){\r\n\t\tlet result = this.getOption('menuLabel', { args: [this, data], default: this.getLabel(data)});\r\n\t\treturn result;\r\n\t},\r\n\r\n\tbuildChildOptions(options){\r\n\t\tlet root = this.getRoot();\r\n\t\tlet defs = {\r\n\t\t\troot,\r\n\t\t\tparent: this.parent,\r\n\t\t\trouter: this.router,\r\n\t\t\tapp: this.app,\r\n\t\t};\r\n\t\tlet result = _.extend(defs, options);\r\n\t\treturn result;\r\n\t},\r\n\r\n\tgetSiblings(opts = {}){\r\n\r\n\t\tlet parent = this.getParent();\r\n\t\tlet options = _.extend({ exclude: [this] }, opts);\r\n\t\treturn parent && parent.getChildren(options) || [];\r\n\r\n\t},\r\n\r\n\tgetHashes(data){\r\n\t\tlet page = this;\r\n\t\tlet parentHash = false;\r\n\t\tif (this.isEntityPage) {\r\n\t\t\tpage = page.getParent();\r\n\t\t\tparentHash = true;\r\n\t\t}\r\n\t\treturn this._getPageHashes(page, data, parentHash);\r\n\t},\r\n\t_getPageHashes(page, data, isParentHash){\r\n\t\tlet parent = page.getParent();\r\n\t\tlet root = page.getRoot();\r\n\r\n\t\treturn {\r\n\t\t\tisParentHash,\r\n\t\t\tpath: page.getPathHash(data),\r\n\t\t\tthis: page.getHash(data),\r\n\t\t\troot: root && root.getHash && root.getHash(data) || undefined,\r\n\t\t\tparent: parent && parent.getHash && parent.getHash(data) || undefined,\r\n\t\t\tchildren: page.getChildrenHashes(data),\r\n\t\t\tsiblings: page.getSiblingsHashes(data)\r\n\t\t};\r\n\t},\r\n\tgetPathHash(data){\r\n\t\tlet self = this.getHash(data);\r\n\t\tlet path = [self];\r\n\t\tlet parent = this.getParent();\r\n\t\tif (parent && _.isFunction(parent.getPathHash)) {\r\n\t\t\tpath.unshift(...parent.getPathHash(data));\r\n\t\t}\r\n\t\treturn path;\r\n\t},\r\n\tgetChildrenHashes(data){\r\n\t\treturn this.getChildren({ map: i => i.getHash(data), visible: true, });\r\n\t},\r\n\tgetSiblingsHashes(data){\r\n\t\treturn this.getSiblings({ map: i => i.getHash(data), visible: true, });\r\n\t},\r\n\r\n\tgetRoot(){\r\n\t\tif (this.root === true) {\r\n\t\t\treturn this;\r\n\t\t} else {\r\n\t\t\treturn this.root;\r\n\t\t}\r\n\t},\r\n\tgetAllPages(opts = {}){\r\n\t\t\r\n\t\tlet options = _.extend({}, opts, { includeSelf: true });\r\n\t\tdelete options.map;\r\n\t\tlet pages = this.getRoot().getAllChildren(options);\r\n\r\n\t\tif (_.isFunction(opts.map)) {\r\n\t\t\treturn _(pages).chain().map(opts.map).filter(f => !!f).value();\r\n\t\t} else {\r\n\t\t\treturn pages;\r\n\t\t}\r\n\t},\r\n\r\n\tgetAllHashes(opts = {}){\r\n\t\tlet options = _.extend({ map: i => i.getHash(), visible: true, }, opts);\r\n\t\treturn this.getAllPages(options);\r\n\t},\r\n\r\n\tgetHash(data){\r\n\t\tlet context = this.getMainRouteContext();\r\n\r\n\t\tif(!_.isObject(context))\r\n\t\t\treturn;\r\n\r\n\t\tlet parent = this.getParent();\r\n\t\tlet parentCid = parent && parent.cid || undefined;\t\t\r\n\t\treturn {\r\n\t\t\tcid: this.cid,\r\n\t\t\tparentCid,\r\n\t\t\tlabel: this.getMenuLabel(data),\r\n\t\t\torder: this.order,\r\n\t\t\troute: context.route,\r\n\t\t\turl: data ? context.getUrl(data) : context.route,\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t_childFilter(item, index, opts = {}) {\r\n\t\tlet base = BasePage.prototype._childFilter;\r\n\t\tif(base && !base.apply(this, arguments))\r\n\t\t\treturn;\r\n\r\n\t\tlet { visible } = opts;\r\n\r\n\t\tif (item.isEntityPage) return;\r\n\r\n\t\tif (visible && (item.visible === false || item.hidden === true))\r\n\t\t\treturn;\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n\tinitializeEvents(){\r\n\t\tif (this._triggerOnParentInitiallized) return;\r\n\r\n\t\tlet triggersOn = [];\r\n\t\tif(this.app){\r\n\t\t\ttriggersOn.push(this.app);\r\n\t\t}\r\n\t\tif(this.router){\r\n\t\t\ttriggersOn.push(this.router);\r\n\t\t}\r\n\t\tlet events = ['start', 'stop'];\r\n\t\t_.each(events, event => {\r\n\t\t\tthis.on(event, (...args) => {\r\n\t\t\t\t_.each(triggersOn, parent => {\r\n\t\t\t\t\tparent.triggerMethod('page:' + event, this, ...args);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis._triggerOnParentInitiallized = true;\r\n\t},\r\n\tgetView(opts){\r\n\t\tlet options = _.extend({ model: this.model, collection: this.collection, page: this }, opts);\r\n\t\treturn this.buildView(options);\r\n\t},\r\n\t//good place to override build options, or build itself\r\n\tbuildView(options){\r\n\t\treturn this._buildViewByKey(options);\r\n\t},\r\n\t_buildViewByKey(options){\t\t\r\n\t\tlet view = buildViewByKey(this, 'Layout', { options });\r\n\t\tif(!view) {\r\n\t\t\tview = buildViewByKey(this, 'layout', { defaultOptions: options });\r\n\t\t}\r\n\t\treturn view;\r\n\t},\r\n\r\n\tgetStartPromises(){\r\n\t\t\r\n\t\tlet promises = this.getOption('startPromises', { args: [ this ]});\r\n\t\tif(!promises) return;\r\n\r\n\t\treturn _.map(promises, item =>{\r\n\t\t\tif (_.isFunction(item)) {\r\n\t\t\t\treturn item.call(this, this);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tgetStopPromises(){\r\n\t\t\r\n\t\tlet promises = this.getOption('stopPromises', { args: [ this ]});\r\n\t\tif(!promises) return;\r\n\r\n\t\treturn _.map(promises, item =>{\r\n\t\t\tif (_.isFunction(item)) {\r\n\t\t\t\treturn item.call(this, this);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t},\t\r\n\r\n});\r\n\r\n","import _ from 'underscore';\r\nimport { App } from 'bbmn-components';\r\nimport { historyApi, historyWatcher } from '../history/index.js';\r\nimport PageRouter from './page-router.js';\r\nimport Page from './page';\r\nimport { buildByKey } from 'bbmn-utils';\r\nimport { isClass } from 'bbmn-core';\r\nimport routeErrorHandler from '../route-error-handler';\r\n\r\nexport default App.extend({\r\n\thistoryWatcher: false,\r\n\tRouter: PageRouter,\r\n\r\n\tconstructor(){\r\n\t\t\r\n\t\tthis._pages = [];\r\n\t\tApp.apply(this, arguments);\r\n\t\tthis._initRouteErrors();\r\n\t\tthis._initPageListeners();\r\n\t},\r\n\t_initRouteErrors(){\r\n\t\tlet handlers = this.getOption('routeErrors', { args: [ this ]});\r\n\t\tif(!_.isObject(handlers)) return;\r\n\t\trouteErrorHandler.setHandlers(handlers, this);\r\n\t},\r\n\t_initPageListeners(){\r\n\t\tthis.once({\r\n\t\t\t'start':this._buildPages,\r\n\t\t\t'pages:ready': this.render,\r\n\t\t\t'layout:ready': this._startHistory\r\n\t\t});\r\n\t\tthis.on({\r\n\t\t\t'page:start': this._onPageStart,\r\n\t\t\t'page:stop': this._onPageStop\r\n\t\t});\r\n\r\n\t\t// this.on('start', this._buildPages);\r\n\t\t// this.on('pages:ready', this._startHistory);\r\n\t\t// this.on('page:start', this._onPageStart);\r\n\t\t// this.on('page:stop', this._onPageStop);\r\n\t},\r\n\t_startHistoryWatcher(){\r\n\t\tif (!this.getOption('historyWatcher')) return;\r\n\t\thistoryWatcher.start();\r\n\t},\r\n\t_startHistory(){\r\n\t\tif (historyApi.isStarted()) return;\r\n\r\n\t\tthis._startHistoryWatcher();\r\n\r\n\t\tlet options = this.getOption('startHistory');\r\n\t\tif(!options) { return; }\r\n\t\tif (options === true) {\r\n\t\t\toptions = { pushState: false };\r\n\t\t} else if (!_.isObject(options)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\t\tthis.triggerMethod('before:history:start', result);\r\n\r\n\t\tvar result = historyApi.start(options);\r\n\r\n\t\tthis.triggerMethod('history:start', result);\r\n\t},\r\n\t_buildPages(){\r\n\t\tthis.triggerMethod('before:pages:ready');\r\n\t\tthis.buildPages();\r\n\t\tthis.triggerMethod('pages:ready');\r\n\t},\r\n\tbuildPages() {\r\n\t\t\r\n\t\tif (this.rootPage instanceof Page) return;\r\n\r\n\t\tthis.triggerMethod('before:router:create');\r\n\t\tthis.router = this.buildRouter();\r\n\t\tthis.triggerMethod('router:create', this.router);\r\n\r\n\t\tvar RootPage = this.getOption('RootPage');\r\n\t\tif (isClass(RootPage, Page)) {\r\n\t\t\tthis.rootPage = new RootPage({ router: this.router, shouldRegisterAllRoutes: true, app: this });\r\n\t\t}\r\n\r\n\t},\t\r\n\tbuildRouter(){\r\n\t\tif (this.router instanceof PageRouter) return this.router;\r\n\t\treturn buildByKey(this, 'Router', { ctor: PageRouter });\r\n\t},\r\n\t_onPageStart(...args){\r\n\t\tthis.showPage(...args);\r\n\t},\r\n\tshowPage: _.noop,\r\n\t_onPageStop(...args){\r\n\t\tthis.hidePage(...args);\r\n\t},\r\n\thidePage: _.noop,\r\n});\r\n"],"names":["get","router","opts","key","update","value","result","context","args","getOption","routeArgumentsToObject","route","name","callback","_","isObject","extend","isFunction","uniqueId","isRouterHoldsActions","rawRoute","isRegExp","_routeToRegExp","callbackWrapper","bind","_processCallback","createActionContext","routeContext","fragment","options","rawArgs","_extractParameters","slice","queryString","pop","qs","prepareActionQueryString","prepareActionArguments","routeType","isString","queryStringParser","params","match","res","each","index","substring","isArray","push","concat","toPromise","arg","resolve","Promise","then","Error","reject","getCallbackFunction","executeResult","exception","promise","processCallback","actionContext","asPromise","triggerEvent","shouldTriggerEvent","execute","lastAttempt","error","handleError","handlers","_getHandleContext","some","applyHandler","handler","getHandler","apply","bindTo","hash","nullable","items","setHandler","reduce","memo","item","getHandleContext","custom","unshift","$","Deferred","constructor","undefined","Router","BbRouter","arguments","routes","getInitRoutes","size","addRoutes","controller","approutes","map","_buildRouteContext","registerRouteContext","_storeCreatedContext","isRouteChaining","normalized","chain","_normalizeRoutes","filter","f","doNotReverse","reverse","registered","addRoute","massAdd","c","clone","has","buildRouteContextFromArguments","buildRouteContext","routeContexts","restart","action","handle","event","trigger","complex","string","paramsToObject","optionalParam","namedParam","splatParam","escapeRegExp","replace","optional","flags","RegExp","find","cntx","test","pathStripper","historyApi","history","getFragment","decodeFragment","decodedFragment","navigate","loadUrl","executed","executeHandler","matchRoot","customTest","testHandler","resultContext","findHandler","start","started","split","url","getUrlPath","join","Watcher","mix","BaseClass","with","Events","isWatching","entries","listenTo","onRoute","onBackRoute","stopListening","length","hasElements","isActionContext","lastElement","gobackContext","lookFor","indexOf","canGoBack","last","BaseRouter","page","contexts","getRoutesContexts","startPage","process","Process","call","errors","shift","_beforePageStart","_afterPageStart","beforePageStart","previousPage","isStarted","stop","afterPageStart","_setPageTitle","title","getTitle","setPageTitle","initializeRouter","_buildRoutesContexts","_createRouter","_shouldRegisterAllRoutes","PageRouter","pages","getAllChildren","includeSelf","force","registerPageRoutes","config","getRoutesConfig","_normalizeRoutesContextRoute","routesContext","isNumber","order","relative","parentContext","getUrl","data","found","group","parent","getMainRouteContext","mainRouteContext","sortBy","a","b","comparator","main","take","BasePage","MnObject","childrenableMixin","startableMixin","RoutesMixin","mergeOptions","initializeRoutes","initializeChildren","registerAllRoutes","initializeEvents","getLabel","default","root","getRoot","defs","app","getParent","exclude","getChildren","parentHash","isEntityPage","_getPageHashes","isParentHash","getPathHash","getHash","getChildrenHashes","getSiblingsHashes","self","path","i","visible","getSiblings","getAllPages","parentCid","cid","getMenuLabel","base","prototype","_childFilter","hidden","_triggerOnParentInitiallized","triggersOn","events","on","triggerMethod","model","collection","buildView","_buildViewByKey","view","buildViewByKey","defaultOptions","promises","App","_pages","_initRouteErrors","_initPageListeners","setHandlers","once","_buildPages","render","_startHistory","_onPageStart","_onPageStop","_startHistoryWatcher","pushState","buildPages","rootPage","Page","buildRouter","RootPage","isClass","shouldRegisterAllRoutes","buildByKey","ctor","showPage","noop","hidePage"],"mappings":"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"}