{"version":3,"file":"index.js","sources":["router/build-route-context.js","router/action-context.js","router/process-callback.js","route-error-handler/index.js","router/router.js","pages/paged-app.js"],"sourcesContent":["import _ from 'underscore';\r\nimport { betterResult as result } from 'bbmn-utils';\r\n\r\nfunction get(router, opts = {}, key, update){\r\n\t\r\n\tlet value = result(opts, key, { context: router, args:[ router ] });\r\n\tif(value == null) {\r\n\t\tvalue = router.getOption(key, {args: [ router ]});\r\n\t\tif(update)\r\n\t\t\topts[key] = value;\r\n\t}\r\n\treturn value;\t\t\r\n}\r\n\r\n// converts route method arguments to plain object;\r\n// _normalizeRegisterRouteArguments\r\n// { route, rawRoute, callback, name }\r\nexport default function routeArgumentsToObject(router, route, name, callback, opts = {}){\r\n\r\n\tlet context = {};\r\n\r\n\tif(_.isObject(route)){\r\n\t\tcontext = route;\r\n\r\n\t\t//then second argument is probably options;\r\n\t\t_.extend(opts, name);\r\n\r\n\t} else if (_.isFunction(name)) {\r\n\t\t_.extend(context, { route, callback: name, name: _.uniqueId('routerAction') });\r\n\t} else {\r\n\t\t_.extend(context, { route, name, callback });\r\n\t}\r\n\r\n\tlet isRouterHoldsActions = get(router, opts, 'isRouterHoldsActions', true);\r\n\r\n\r\n\t// last chance to get callback from router instance by name\r\n\t// this behavior can be disabled through `isRouterHoldsActions` options\r\n\tif(!_.isFunction(context.callback) && isRouterHoldsActions && _.isFunction(router[context.name])) {\r\n\r\n\t\tcontext.callback = router[context.name];\r\n\r\n\t}\r\n\r\n\t//store original route\r\n\tcontext.rawRoute = context.route;\r\n\r\n\t!context.name && (context.name = _.uniqueId('routerAction'));\r\n\r\n\t//converts route to RegExp pattern\r\n\tif (!_.isRegExp(context.route)) context.route = router._routeToRegExp(context.route);\r\n\r\n\t// by default backbone router wraps every callback with own wrapper\r\n\t// which in turn call actual callback with correct arguments on route\r\n\t// this callback was inlined and can not be overrided, so now its possible\t\r\n\tcontext.callbackWrapper = _.bind(router._processCallback, router, context);\r\n\r\n\treturn context;\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\n\r\nexport function createActionContext(router, routeContext, fragment, options = {}) {\r\n\r\n\tlet rawArgs = router._extractParameters(routeContext.route, fragment);\r\n\r\n\tlet result = _.extend({}, routeContext, { fragment, rawArgs }, options, { options });\r\n\r\n\tlet args = rawArgs.slice(0);\r\n\tlet queryString = args.pop();\r\n\r\n\t_.extend(result, { qs: prepareActionQueryString(router, queryString) });\r\n\t_.extend(result, { args: prepareActionArguments(routeContext.rawRoute, args) });\r\n\r\n\tif (result.routeType == null) {\r\n\t\tresult.routeType = 'route';\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction prepareActionQueryString(router, queryString){\r\n\tif(_.isString(queryString))\r\n\t\treturn router.queryStringParser(queryString);\r\n\telse\r\n\t\treturn {};\r\n}\r\n\r\nfunction prepareActionArguments(rawRoute, args){\r\n\r\n\tlet params = rawRoute.match(/:([^/|)]+)/g) || [];\r\n\t\r\n\tlet res = {};\r\n\t_(params).each((name, index) => {\r\n\t\tname = name.substring(1);\r\n\t\t\r\n\t\tif(args == null) return;\r\n\r\n\t\tif(name in res && _.isArray(res[name]))\r\n\t\t\tres[name].push(args[index]);\r\n\t\telse if(name in res && !_.isArray(res[name]))\r\n\t\t\tres[name] = [res[name]].concat(args[index]);\r\n\t\telse\r\n\t\t\tres[name] = args[index];\r\n\t});\r\n\treturn res;\r\n}\r\n","import _ from 'underscore';\r\n\r\nfunction toPromise(arg, resolve = true){\r\n\tif (arg instanceof Promise || (arg && _.isFunction(arg.then)))\r\n\t\treturn arg;\r\n\telse if (arg instanceof Error)\r\n\t\treturn Promise.reject(arg);\r\n\telse\r\n\t\treturn resolve \r\n\t\t\t? Promise.resolve(arg) \r\n\t\t\t: Promise.reject(arg);\r\n}\r\n\r\n\r\nfunction getCallbackFunction(callback, executeResult)\r\n{\r\n\treturn (...args) => {\r\n\t\ttry {\r\n\t\t\texecuteResult.value = callback && callback(...args);\r\n\t\t} catch(exception) {\r\n\t\t\texecuteResult.value = exception;\r\n\t\t}\r\n\t\texecuteResult.promise = toPromise(executeResult.value);\r\n\t\treturn executeResult.value;\r\n\t};\r\n}\r\n\r\n\r\nexport function processCallback(router, actionContext, routeType){\t\r\n\t\r\n\tlet args = router.getOption('classicMode') \r\n\t\t? actionContext.rawArgs || [] \r\n\t\t: [ actionContext ];\r\n\r\n\tlet asPromise = router.getOption('callbackAsPromises');\r\n\tlet executeResult = {};\r\n\tlet callback = getCallbackFunction(actionContext.callback, executeResult, asPromise);\r\n\r\n\r\n\t\r\n\trouter.triggerEvent('before:' + routeType, actionContext);\r\n\r\n\tlet shouldTriggerEvent = router.execute(callback, args);\r\n\tif (shouldTriggerEvent !== false) {\r\n\t\trouter.triggerEvent(routeType, actionContext);\r\n\t\tif(routeType == 'route' || routeType == 'backroute')\r\n\t\t\trouter.lastAttempt = actionContext;\r\n\t}\r\n\r\n\texecuteResult.promise.then(\r\n\t\t(arg) => {\r\n\t\t\trouter.triggerEvent('after:'+routeType, actionContext);\r\n\t\t\treturn arg;\r\n\t\t},\r\n\t\t(error) => {\r\n\t\t\trouter.triggerEvent('error:' + routeType, error, actionContext);\r\n\t\t\trouter.handleError(error, actionContext);\r\n\t\t}\r\n\t);\r\n\r\n\treturn executeResult.value;\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n\r\nexport default {\r\n\thandlers: {\r\n\t\t'js:error'(error){\r\n\t\t\tthrow error;\r\n\t\t},\r\n\t},\r\n\thandle(error, context, args){\r\n\r\n\t\tlet handlers = this._getHandleContext(error, context, args) || {};\r\n\t\treturn _(handlers).some((options, key) => this.applyHandler(key, options));\r\n\r\n\t},\r\n\tapplyHandler(key, options = {}){\r\n\r\n\t\tlet handler = this.getHandler(key, options);\r\n\t\tif (!handler) return;\r\n\t\tlet { context, args } = options;\r\n\t\treturn handler.apply(context, args);\r\n\r\n\t},\r\n\tgetHandler(key){\r\n\t\tif(_.isFunction(this.handlers[key]))\r\n\t\t\treturn this.handlers[key];\r\n\t},\r\n\tsetHandler(key, handler){\r\n\t\tif(!_.isString(key) || key === '')\r\n\t\t\tthrow new Error('setHandler first argument must be a non empty string');\r\n\r\n\t\tif (!_.isFunction(handler)) {\r\n\t\t\tdelete this.handlers[key];\r\n\t\t} else {\r\n\t\t\tthis.handlers[key] = handler;\r\n\t\t}\r\n\t},\r\n\tsetHandlers(hash){\r\n\t\tlet nullable = hash === null;\r\n\t\tlet items = nullable && this.handlers || hash;\r\n\t\tif(!_.isObject(items)) return;\r\n\t\t_(items).each((handler, key) => this.setHandler(key, nullable || handler));\r\n\t},\r\n\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\t_getHandleContext(error, context, args = []){\r\n\r\n\t\tif (_.isArray(error)) {\r\n\t\t\treturn _(error).reduce((memo, item) => _.extend(memo, this._getHandleContext(item, context, args)), {});\r\n\t\t}\r\n\r\n\t\tif(_.isFunction(this.getHandleContext)) {\r\n\t\t\tlet custom = this.getHandleContext(error, context, args);\r\n\t\t\tif(custom != null) return custom;\r\n\t\t}\r\n\r\n\t\tif (error instanceof Error) {\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'js:error': { context, args } };\r\n\t\t}\r\n\t\telse if(_.isString(error)) {\r\n\t\t\treturn { [error]: { context, args } };\r\n\t\t}\r\n\t\telse if(error instanceof $.Deferred().constructor){\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'jq:xhr': { context, args }};\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// provide your own arguments processor\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\tgetHandleContext: undefined,\r\n\r\n};\r\n","import _ from 'underscore';\r\nimport {  getOption, paramsToObject as paramStringToObject } from 'bbmn-utils';\r\nimport { Router as BbRouter } from 'bbmn-core';\r\n\r\n//import paramStringToObject from '../../../utils/params-to-object/index.js';\r\n//import { Backbone, Router as BbRouter } from '../../../vendors/backbone.js';\r\n\r\nimport buildRouteContextFromArguments from './build-route-context.js';\r\n\r\nimport  { createActionContext } from './action-context.js';\r\nimport { processCallback } from './process-callback.js';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\n\r\n\r\nconst Router = BbRouter.extend({\r\n\r\n\r\n\t// for migrating from Mn.AppRoute\r\n\t// set to true. it will populate routes from { controller, appRoutes } structure.\r\n\tisMarionetteStyle: false,\r\n\r\n\t// by default Backbone.Router tries to lookup callback in router instance by name `callback = this[name]` if there is no callback provided\r\n\t// its recomend to turn this feature to false\r\n\t// default value is true for Backbone.Router compatability\r\n\tisRouterHoldsActions : true,\r\n\r\n\t// by default Backbone.Router `route` method returns router itself instead of just created routeContext for chaining purposes.\r\n\t// you can change this behavior turning this feature to false\r\n\tisRouteChaining: true,\r\n\r\n\t//in classic mode actions receive argument array\r\n\t//if you need actionContext instead turn this option to false\r\n\tclassicMode: true,\r\n\r\n\tconstructor(options = {}){\r\n\t\t\r\n\t\tthis.options = _.extend({}, _.result(this, 'options'), options);\r\n\r\n\t\tBbRouter.apply(this, arguments);\r\n\r\n\r\n\t},\r\n\r\n\tgetOption(){\r\n\t\treturn getOption.call(this, ...arguments);\r\n\t},\r\n\r\n\t/*\r\n\r\n\t\tinitialize methods\r\n\t\t\"when a router initialized\"\r\n\r\n\t*/\r\n\r\n\t//by default router expects that routes will result in { route, callback } hash\r\n\t//we are extending this to provide more flexibility\r\n\t// - overrided\r\n\t_bindRoutes: function() {\r\n\t\t\r\n\t\tlet routes = this.getInitRoutes();\r\n\t\tif(!_.size(routes)) return;\r\n\t\tthis.addRoutes(routes);\r\n\r\n\t},\r\n\tgetInitRoutes(){\r\n\t\tlet routes;\r\n\t\tif(this.getOption('isMarionetteStyle')) {\r\n\t\t\tlet controller = this.getOption('controller') || {};\r\n\t\t\tlet approutes = this.getOption('appRoutes') || {};\r\n\t\t\troutes = _(approutes).map((name, route) => ({ \r\n\t\t\t\troute, name, \r\n\t\t\t\tcallback: controller[name] \r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\troutes = this.getOption('routes');\r\n\t\t}\r\n\t\treturn routes;\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tmanipulating routes\r\n\t\tadding\r\n\t*/\r\n\r\n\t// refactored original route method\r\n\t// chain:true by default is for supporting default behavior\r\n\t// routerHoldsActions: true - backbone router tries to get callback from router itself if there is no callback provided. \r\n\t// this options allow to support this behavior, but its recomended not to hold action inside router instance\r\n\t// - overrided\r\n\troute(route, name, callback, opts = {}){\r\n\t\t\r\n\t\t//normalizing passed arguments and putting them into a context object\r\n\t\t//refactored from original route\r\n\t\t// let context = this._normalizeRegisterRouteArguments(route, name, callback, opts);\r\n\r\n\t\t// //extends context with result of `mergeWithRegisterRouteContext`\r\n\t\t// this._normalizeRegisterRouteContext(context);\r\n\r\n\t\t// //wrapping provided callback \r\n\t\t// this._normalizeRegisterRouteCallback(context);\r\n\r\n\t\tlet context = this._buildRouteContext(route, name, callback, opts);\r\n\r\n\t\t//refactored for providing possibility to override\r\n\t\t//at this point context should be almost ready\r\n\t\tthis.registerRouteContext(context);\r\n\r\n\t\tthis._storeCreatedContext(context, opts);\r\n\r\n\t\treturn opts.isRouteChaining === true \r\n\t\t\t? this \r\n\t\t\t: context;\r\n\r\n\t},\r\n\r\n\t// provide more semantic alias for route\r\n\taddRoute(route, name, callback, opts = {}){\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet context = this.route(route, name, callback, opts);\r\n\t\treturn context;\r\n\t},\r\n\r\n\t//process many routes at once\r\n\t//accepts object { name, routeContext | handler }\r\n\t// or array of routeContexts\r\n\taddRoutes(routes, opts = {}){\r\n\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet normalized = _(routes)\r\n\t\t\t.chain()\r\n\t\t\t.map((value, key) => this._normalizeRoutes(value, key))\r\n\t\t\t.filter(f => _.isObject(f))\r\n\t\t\t.value();\r\n\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tnormalized.reverse();\r\n\r\n\t\tlet registered = _(normalized).map(\r\n\t\t\troute => route && \r\n\t\t\tthis.addRoute(route, _.extend({ massAdd:true }, opts))\r\n\t\t); \r\n\t\t\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tregistered.reverse();\r\n\r\n\t\t_(registered).each((c) => this._storeCreatedContext(c));\r\n\t\t\r\n\t\treturn registered;\r\n\t},\r\n\r\n\t// internal method called by `addRoutes` to normalize provided data\r\n\t_normalizeRoutes(value, key){\r\n\t\t//let route, name, callback;\r\n\t\tlet context;\r\n\t\tif (_.isString(value)) {\r\n\t\t\tcontext = { \r\n\t\t\t\troute: key, \r\n\t\t\t\tname: value, \r\n\t\t\t};\r\n\t\t}\r\n\t\telse if(_.isFunction(value)){\r\n\t\t\tcontext = { route:key, callback:value };\r\n\t\t}else if(_.isObject(value)){\r\n\t\t\tcontext = _.clone(value);\r\n\t\t\tif(!_.has(context, 'route'))\r\n\t\t\t\tcontext.route = key;\r\n\t\t\telse if(_.has(context, 'route') && !_.has(context, 'name'))\r\n\t\t\t\tcontext.name = key;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_buildRouteContext(route, name, callback, opts) {\r\n\r\n\t\tlet context = buildRouteContextFromArguments(this, route, name, callback, opts);\r\n\r\n\t\treturn this.buildRouteContext(context);\r\n\t},\r\n\r\n\t//override this method if you need more information in route context\r\n\t// should return object wich will be merged with default context\r\n\t// be aware of providing reserved properties: route, name, callback\r\n\t// this will override context defaults\r\n\tbuildRouteContext: context => context,\r\n\r\n\r\n\t//finally, putting handler to the backbone.history.handlers\r\n\tregisterRouteContext(context){\r\n\t\tBackbone.history.route(context.route, context.callbackWrapper, context);\r\n\t},\r\n\r\n\t//store registered context for further use\r\n\t_storeCreatedContext(context, opts = {}){\r\n\t\tthis.routeContexts || (this.routeContexts = {});\r\n\t\tif(!opts.massAdd)\r\n\t\t\tthis.routeContexts[context.name] = context;\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\t/*\r\n\t\r\n\t\tprocess route methods\t\t\r\n\t\t\"when route happens\"\r\n\r\n\t*/\r\n\r\n\t//inner route handler\r\n\t//preparing actionContext and calls public processCallback\r\n\t_processCallback (routeContext, fragment, options = {}) {\r\n\t\tlet actionContext = createActionContext(this, routeContext, fragment, options);\r\n\t\tactionContext.restart = () => actionContext.callbackWrapper(fragment, options);\r\n\t\tlet result = this.processCallback(actionContext, actionContext.routeType, options);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t//by default behave as original router\r\n\t//override this method to process action by your own\r\n\tprocessCallback(actionContext, routeType){\r\n\r\n\t\treturn processCallback(this, actionContext, routeType);\r\n\r\n\t},\r\n\r\n\thandleError(error, action){\t\t\r\n\t\terrorHandler.handle(error, this, [action]);\r\n\t},\r\n\r\n\t//just triggers appropriate events\r\n\t// triggerRouteEvents(context, event, name, ...args) {\r\n\t// \tif (event == 'route') {\r\n\t// \t\tthis.lastActionContext = context;\r\n\t// \t}\r\n\t// \tthis.trigger(`${event}:${name}`, ...args);\r\n\t// \tthis.trigger(event, name, ...args);\r\n\t// \tBackbone.history.trigger(event, this, name, ...args);\r\n\t// },\r\n\r\n\ttriggerEvent(event, context){\r\n\t\tthis.trigger(event, context);\r\n\t\tBackbone.history.trigger(event, context);\r\n\t},\r\n\r\n\r\n\r\n\r\n\t//converts string to object\r\n\t//default implementation, can be overriden by user\r\n\tqueryStringParser: paramStringToObject,\t\r\n\r\n\t// navigate(...args){\r\n\t// \thistoryNavigate(...args);\r\n\t// \treturn this;\r\n\t// },\r\n\r\n\t_routeToRegExp(route) {\r\n\r\n\t\tvar optionalParam = /\\((.*?)\\)/g;\r\n\t\tvar namedParam    = /(\\(\\?)?:\\w+/g;\r\n\t\tvar splatParam    = /\\*\\w+/g;\r\n\t\tvar escapeRegExp  = /[-{}[]+?.,\\\\\\^$|#\\s]/g;\r\n\r\n\t\troute = route.replace(escapeRegExp, '\\\\$&')\r\n\t\t\t.replace(optionalParam, '(?:$1)?')\r\n\t\t\t.replace(namedParam, function(match, optional) {\r\n\t\t\t\treturn optional ? match : '([^/?]+)';\r\n\t\t\t})\r\n\t\t\t.replace(splatParam, '([^?]*?)');\r\n\t\tlet flags = this.getOption('routeCaseInsensitive') ? 'i' : '';\r\n\t\treturn new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$', flags);\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tSome API methods\r\n\t*/\r\n\r\n\tgetContextByFragment(fragment)\t{\r\n\t\tif(!_.isString(fragment)) return;\r\n\t\t//let contexts = this.routeContexts;\r\n\t\t//console.log('Router contexts', contexts);\r\n\t\tlet result = _(this.routeContexts).find((cntx) => cntx.route.test(fragment));\r\n\t\treturn result;\r\n\t}\r\n\r\n\r\n});\r\n\r\nexport default Router;\r\n","import { App } from 'bbmn-components';\r\n\r\nexport default App.extend({\r\n\r\n});\r\n"],"names":["get","router","opts","key","update","value","result","context","args","getOption","routeArgumentsToObject","route","name","callback","_","isObject","extend","isFunction","uniqueId","isRouterHoldsActions","rawRoute","isRegExp","_routeToRegExp","callbackWrapper","bind","_processCallback","createActionContext","routeContext","fragment","options","rawArgs","_extractParameters","slice","queryString","pop","qs","prepareActionQueryString","prepareActionArguments","routeType","isString","queryStringParser","params","match","res","each","index","substring","isArray","push","concat","toPromise","arg","resolve","Promise","then","Error","reject","getCallbackFunction","executeResult","exception","promise","processCallback","actionContext","asPromise","triggerEvent","shouldTriggerEvent","execute","lastAttempt","error","handleError","handlers","_getHandleContext","some","applyHandler","handler","getHandler","apply","hash","nullable","items","setHandler","reduce","memo","item","getHandleContext","custom","unshift","$","Deferred","constructor","undefined","Router","BbRouter","arguments","call","routes","getInitRoutes","size","addRoutes","controller","approutes","map","_buildRouteContext","registerRouteContext","_storeCreatedContext","isRouteChaining","normalized","chain","_normalizeRoutes","filter","f","doNotReverse","reverse","registered","addRoute","massAdd","c","clone","has","buildRouteContextFromArguments","buildRouteContext","history","routeContexts","restart","action","handle","event","trigger","paramStringToObject","optionalParam","namedParam","splatParam","escapeRegExp","replace","optional","flags","RegExp","find","cntx","test","App"],"mappings":"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"}