{"version":3,"file":"index.js","sources":["router/build-route-context.js","router/action-context.js","router/process-callback.js","route-error-handler/index.js","router/router.js","history/index.js","pages/page-router.js","../node_modules/bbmn-mixins/lib/es/index.js","pages/routes-mixin.js","pages/page.js","pages/paged-app.js"],"sourcesContent":["import _ from 'underscore';\r\nimport { betterResult as result } from 'bbmn-utils';\r\n\r\nfunction get(router, opts = {}, key, update){\r\n\t\r\n\tlet value = result(opts, key, { context: router, args:[ router ] });\r\n\tif(value == null) {\r\n\t\tvalue = router.getOption(key, {args: [ router ]});\r\n\t\tif(update)\r\n\t\t\topts[key] = value;\r\n\t}\r\n\treturn value;\t\t\r\n}\r\n\r\n// converts route method arguments to plain object;\r\n// _normalizeRegisterRouteArguments\r\n// { route, rawRoute, callback, name }\r\nexport default function routeArgumentsToObject(router, route, name, callback, opts = {}){\r\n\r\n\tlet context = {};\r\n\r\n\tif(_.isObject(route)){\r\n\t\tcontext = route;\r\n\r\n\t\t//then second argument is probably options;\r\n\t\t_.extend(opts, name);\r\n\r\n\t} else if (_.isFunction(name)) {\r\n\t\t_.extend(context, { route, callback: name, name: _.uniqueId('routerAction') });\r\n\t} else {\r\n\t\t_.extend(context, { route, name, callback });\r\n\t}\r\n\r\n\tlet isRouterHoldsActions = get(router, opts, 'isRouterHoldsActions', true);\r\n\r\n\r\n\t// last chance to get callback from router instance by name\r\n\t// this behavior can be disabled through `isRouterHoldsActions` options\r\n\tif(!_.isFunction(context.callback) && isRouterHoldsActions && _.isFunction(router[context.name])) {\r\n\r\n\t\tcontext.callback = router[context.name];\r\n\r\n\t}\r\n\r\n\t//store original route\r\n\tcontext.rawRoute = context.route;\r\n\r\n\t!context.name && (context.name = _.uniqueId('routerAction'));\r\n\r\n\t//converts route to RegExp pattern\r\n\tif (!_.isRegExp(context.route)) context.route = router._routeToRegExp(context.route);\r\n\r\n\t// by default backbone router wraps every callback with own wrapper\r\n\t// which in turn call actual callback with correct arguments on route\r\n\t// this callback was inlined and can not be overrided, so now its possible\t\r\n\tcontext.callbackWrapper = _.bind(router._processCallback, router, context);\r\n\r\n\treturn context;\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\n\r\nexport function createActionContext(router, routeContext, fragment, options = {}) {\r\n\r\n\tlet rawArgs = router._extractParameters(routeContext.route, fragment);\r\n\r\n\tlet result = _.extend({}, routeContext, { fragment, rawArgs }, options, { options });\r\n\r\n\tlet args = rawArgs.slice(0);\r\n\tlet queryString = args.pop();\r\n\r\n\t_.extend(result, { qs: prepareActionQueryString(router, queryString) });\r\n\t_.extend(result, { args: prepareActionArguments(routeContext.rawRoute, args) });\r\n\r\n\tif (result.routeType == null) {\r\n\t\tresult.routeType = 'route';\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction prepareActionQueryString(router, queryString){\r\n\tif(_.isString(queryString))\r\n\t\treturn router.queryStringParser(queryString);\r\n\telse\r\n\t\treturn {};\r\n}\r\n\r\nfunction prepareActionArguments(rawRoute, args){\r\n\r\n\tlet params = rawRoute.match(/:([^/|)]+)/g) || [];\r\n\t\r\n\tlet res = {};\r\n\t_(params).each((name, index) => {\r\n\t\tname = name.substring(1);\r\n\t\t\r\n\t\tif(args == null) return;\r\n\r\n\t\tif(name in res && _.isArray(res[name]))\r\n\t\t\tres[name].push(args[index]);\r\n\t\telse if(name in res && !_.isArray(res[name]))\r\n\t\t\tres[name] = [res[name]].concat(args[index]);\r\n\t\telse\r\n\t\t\tres[name] = args[index];\r\n\t});\r\n\treturn res;\r\n}\r\n","import _ from 'underscore';\r\n\r\nfunction toPromise(arg, resolve = true){\r\n\tif (arg instanceof Promise || (arg && _.isFunction(arg.then)))\r\n\t\treturn arg;\r\n\telse if (arg instanceof Error)\r\n\t\treturn Promise.reject(arg);\r\n\telse\r\n\t\treturn resolve \r\n\t\t\t? Promise.resolve(arg) \r\n\t\t\t: Promise.reject(arg);\r\n}\r\n\r\n\r\nfunction getCallbackFunction(callback, executeResult)\r\n{\r\n\treturn (...args) => {\r\n\t\ttry {\r\n\t\t\texecuteResult.value = callback && callback(...args);\r\n\t\t} catch(exception) {\r\n\t\t\texecuteResult.value = exception;\r\n\t\t}\r\n\t\texecuteResult.promise = toPromise(executeResult.value);\r\n\t\treturn executeResult.value;\r\n\t};\r\n}\r\n\r\n\r\nexport function processCallback(router, actionContext, routeType){\t\r\n\t\r\n\tlet args = router.getOption('classicMode') \r\n\t\t? actionContext.rawArgs || [] \r\n\t\t: [ actionContext ];\r\n\r\n\tlet asPromise = router.getOption('callbackAsPromises');\r\n\tlet executeResult = {};\r\n\tlet callback = getCallbackFunction(actionContext.callback, executeResult, asPromise);\r\n\r\n\r\n\t\r\n\trouter.triggerEvent('before:' + routeType, actionContext);\r\n\r\n\tlet shouldTriggerEvent = router.execute(callback, args);\r\n\tif (shouldTriggerEvent !== false) {\r\n\t\trouter.triggerEvent(routeType, actionContext);\r\n\t\tif(routeType == 'route' || routeType == 'backroute')\r\n\t\t\trouter.lastAttempt = actionContext;\r\n\t}\r\n\r\n\texecuteResult.promise.then(\r\n\t\t(arg) => {\r\n\t\t\trouter.triggerEvent('after:'+routeType, actionContext);\r\n\t\t\treturn arg;\r\n\t\t},\r\n\t\t(error) => {\r\n\t\t\trouter.triggerEvent('error:' + routeType, error, actionContext);\r\n\t\t\trouter.handleError(error, actionContext);\r\n\t\t}\r\n\t);\r\n\r\n\treturn executeResult.value;\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n//import $ from 'jquery';\r\n\r\nexport default {\r\n\thandlers: {\r\n\t\t'js:error'(error){\r\n\t\t\tthrow error;\r\n\t\t},\r\n\t},\r\n\thandle(error, context, args){\r\n\r\n\t\tlet handlers = this._getHandleContext(error, context, args) || {};\r\n\t\treturn _(handlers).some((options, key) => this.applyHandler(key, options));\r\n\r\n\t},\r\n\tapplyHandler(key, options = {}){\r\n\r\n\t\tlet handler = this.getHandler(key, options);\r\n\t\tif (!handler) return;\r\n\t\tlet { context, args } = options;\r\n\t\treturn handler.apply(context, args);\r\n\r\n\t},\r\n\tgetHandler(key){\r\n\t\tif(_.isFunction(this.handlers[key]))\r\n\t\t\treturn this.handlers[key];\r\n\t},\r\n\tsetHandler(key, handler){\r\n\t\tif(!_.isString(key) || key === '')\r\n\t\t\tthrow new Error('setHandler first argument must be a non empty string');\r\n\r\n\t\tif (!_.isFunction(handler)) {\r\n\t\t\tdelete this.handlers[key];\r\n\t\t} else {\r\n\t\t\tthis.handlers[key] = handler;\r\n\t\t}\r\n\t},\r\n\tsetHandlers(hash){\r\n\t\tlet nullable = hash === null;\r\n\t\tlet items = nullable && this.handlers || hash;\r\n\t\tif(!_.isObject(items)) return;\r\n\t\t_(items).each((handler, key) => this.setHandler(key, nullable || handler));\r\n\t},\r\n\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\t_getHandleContext(error, context, args = []){\r\n\r\n\t\tif (_.isArray(error)) {\r\n\t\t\treturn _(error).reduce((memo, item) => _.extend(memo, this._getHandleContext(item, context, args)), {});\r\n\t\t}\r\n\r\n\t\tif(_.isFunction(this.getHandleContext)) {\r\n\t\t\tlet custom = this.getHandleContext(error, context, args);\r\n\t\t\tif(custom != null) return custom;\r\n\t\t}\r\n\r\n\t\tif (error instanceof Error) {\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'js:error': { context, args } };\r\n\t\t}\r\n\t\telse if(_.isString(error)) {\r\n\t\t\treturn { [error]: { context, args } };\r\n\t\t}\r\n\t\telse if(error instanceof $.Deferred().constructor){\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'jq:xhr': { context, args }};\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// provide your own arguments processor\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\tgetHandleContext: undefined,\r\n\r\n};\r\n","import _ from 'underscore';\r\nimport {  getOption, paramsToObject as paramStringToObject } from 'bbmn-utils';\r\nimport { Router as BbRouter, history } from 'bbmn-core';\r\n\r\n//import paramStringToObject from '../../../utils/params-to-object/index.js';\r\n//import { Backbone, Router as BbRouter } from '../../../vendors/backbone.js';\r\n\r\nimport buildRouteContextFromArguments from './build-route-context.js';\r\n\r\nimport  { createActionContext } from './action-context.js';\r\nimport { processCallback } from './process-callback.js';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\n\r\n\r\nconst Router = BbRouter.extend({\r\n\r\n\r\n\t// for migrating from Mn.AppRoute\r\n\t// set to true. it will populate routes from { controller, appRoutes } structure.\r\n\tisMarionetteStyle: false,\r\n\r\n\t// by default Backbone.Router tries to lookup callback in router instance by name `callback = this[name]` if there is no callback provided\r\n\t// its recomend to turn this feature to false\r\n\t// default value is true for Backbone.Router compatability\r\n\tisRouterHoldsActions : true,\r\n\r\n\t// by default Backbone.Router `route` method returns router itself instead of just created routeContext for chaining purposes.\r\n\t// you can change this behavior turning this feature to false\r\n\tisRouteChaining: true,\r\n\r\n\t//in classic mode actions receive argument array\r\n\t//if you need actionContext instead turn this option to false\r\n\tclassicMode: true,\r\n\r\n\tconstructor(options = {}){\r\n\t\t\r\n\t\tthis.options = _.extend({}, _.result(this, 'options'), options);\r\n\r\n\t\tBbRouter.apply(this, arguments);\r\n\r\n\r\n\t},\r\n\r\n\tgetOption(){\r\n\t\treturn getOption.call(this, ...arguments);\r\n\t},\r\n\r\n\t/*\r\n\r\n\t\tinitialize methods\r\n\t\t\"when a router initialized\"\r\n\r\n\t*/\r\n\r\n\t//by default router expects that routes will result in { route, callback } hash\r\n\t//we are extending this to provide more flexibility\r\n\t// - overrided\r\n\t_bindRoutes: function() {\r\n\t\t\r\n\t\tlet routes = this.getInitRoutes();\r\n\t\tif(!_.size(routes)) return;\r\n\t\tthis.addRoutes(routes);\r\n\r\n\t},\r\n\tgetInitRoutes(){\r\n\t\tlet routes;\r\n\t\tif(this.getOption('isMarionetteStyle')) {\r\n\t\t\tlet controller = this.getOption('controller') || {};\r\n\t\t\tlet approutes = this.getOption('appRoutes') || {};\r\n\t\t\troutes = _(approutes).map((name, route) => ({ \r\n\t\t\t\troute, name, \r\n\t\t\t\tcallback: controller[name] \r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\troutes = this.getOption('routes');\r\n\t\t}\r\n\t\treturn routes;\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tmanipulating routes\r\n\t\tadding\r\n\t*/\r\n\r\n\t// refactored original route method\r\n\t// chain:true by default is for supporting default behavior\r\n\t// routerHoldsActions: true - backbone router tries to get callback from router itself if there is no callback provided. \r\n\t// this options allow to support this behavior, but its recomended not to hold action inside router instance\r\n\t// - overrided\r\n\troute(route, name, callback, opts = {}){\r\n\t\t\r\n\t\t//normalizing passed arguments and putting them into a context object\r\n\t\t//refactored from original route\r\n\t\t// let context = this._normalizeRegisterRouteArguments(route, name, callback, opts);\r\n\r\n\t\t// //extends context with result of `mergeWithRegisterRouteContext`\r\n\t\t// this._normalizeRegisterRouteContext(context);\r\n\r\n\t\t// //wrapping provided callback \r\n\t\t// this._normalizeRegisterRouteCallback(context);\r\n\r\n\t\tlet context = this._buildRouteContext(route, name, callback, opts);\r\n\r\n\t\t//refactored for providing possibility to override\r\n\t\t//at this point context should be almost ready\r\n\t\tthis.registerRouteContext(context);\r\n\r\n\t\tthis._storeCreatedContext(context, opts);\r\n\r\n\t\treturn opts.isRouteChaining === true \r\n\t\t\t? this \r\n\t\t\t: context;\r\n\r\n\t},\r\n\r\n\t// provide more semantic alias for route\r\n\taddRoute(route, name, callback, opts = {}){\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet context = this.route(route, name, callback, opts);\r\n\t\treturn context;\r\n\t},\r\n\r\n\t//process many routes at once\r\n\t//accepts object { name, routeContext | handler }\r\n\t// or array of routeContexts\r\n\taddRoutes(routes, opts = {}){\r\n\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet normalized = _(routes)\r\n\t\t\t.chain()\r\n\t\t\t.map((value, key) => this._normalizeRoutes(value, key))\r\n\t\t\t.filter(f => _.isObject(f))\r\n\t\t\t.value();\r\n\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tnormalized.reverse();\r\n\r\n\t\tlet registered = _(normalized).map(\r\n\t\t\troute => route && \r\n\t\t\tthis.addRoute(route, _.extend({ massAdd:true }, opts))\r\n\t\t); \r\n\t\t\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tregistered.reverse();\r\n\r\n\t\t_(registered).each((c) => this._storeCreatedContext(c));\r\n\t\t\r\n\t\treturn registered;\r\n\t},\r\n\r\n\t// internal method called by `addRoutes` to normalize provided data\r\n\t_normalizeRoutes(value, key){\r\n\t\t//let route, name, callback;\r\n\t\tlet context;\r\n\t\tif (_.isString(value)) {\r\n\t\t\tcontext = { \r\n\t\t\t\troute: key, \r\n\t\t\t\tname: value, \r\n\t\t\t};\r\n\t\t}\r\n\t\telse if(_.isFunction(value)){\r\n\t\t\tcontext = { route:key, callback:value };\r\n\t\t}else if(_.isObject(value)){\r\n\t\t\tcontext = _.clone(value);\r\n\t\t\tif(!_.has(context, 'route'))\r\n\t\t\t\tcontext.route = key;\r\n\t\t\telse if(_.has(context, 'route') && !_.has(context, 'name'))\r\n\t\t\t\tcontext.name = key;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_buildRouteContext(route, name, callback, opts) {\r\n\r\n\t\tlet context = buildRouteContextFromArguments(this, route, name, callback, opts);\r\n\r\n\t\treturn this.buildRouteContext(context);\r\n\t},\r\n\r\n\t//override this method if you need more information in route context\r\n\t// should return object wich will be merged with default context\r\n\t// be aware of providing reserved properties: route, name, callback\r\n\t// this will override context defaults\r\n\tbuildRouteContext: context => context,\r\n\r\n\r\n\t//finally, putting handler to the backbone.history.handlers\r\n\tregisterRouteContext(context){\r\n\t\thistory.route(context.route, context.callbackWrapper, context);\r\n\t},\r\n\r\n\t//store registered context for further use\r\n\t_storeCreatedContext(context, opts = {}){\r\n\t\tthis.routeContexts || (this.routeContexts = {});\r\n\t\tif(!opts.massAdd)\r\n\t\t\tthis.routeContexts[context.name] = context;\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\t/*\r\n\t\r\n\t\tprocess route methods\t\t\r\n\t\t\"when route happens\"\r\n\r\n\t*/\r\n\r\n\t//inner route handler\r\n\t//preparing actionContext and calls public processCallback\r\n\t_processCallback (routeContext, fragment, options = {}) {\r\n\t\tlet actionContext = createActionContext(this, routeContext, fragment, options);\r\n\t\tactionContext.restart = () => actionContext.callbackWrapper(fragment, options);\r\n\t\tlet result = this.processCallback(actionContext, actionContext.routeType, options);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t//by default behave as original router\r\n\t//override this method to process action by your own\r\n\tprocessCallback(actionContext, routeType){\r\n\r\n\t\treturn processCallback(this, actionContext, routeType);\r\n\r\n\t},\r\n\r\n\thandleError(error, action){\t\t\r\n\t\terrorHandler.handle(error, this, [action]);\r\n\t},\r\n\r\n\t//just triggers appropriate events\r\n\t// triggerRouteEvents(context, event, name, ...args) {\r\n\t// \tif (event == 'route') {\r\n\t// \t\tthis.lastActionContext = context;\r\n\t// \t}\r\n\t// \tthis.trigger(`${event}:${name}`, ...args);\r\n\t// \tthis.trigger(event, name, ...args);\r\n\t// \tBackbone.history.trigger(event, this, name, ...args);\r\n\t// },\r\n\r\n\ttriggerEvent(event, context){\r\n\t\tthis.trigger(event, context);\r\n\t\thistory.trigger(event, context);\r\n\t},\r\n\r\n\r\n\r\n\r\n\t//converts string to object\r\n\t//default implementation, can be overriden by user\r\n\tqueryStringParser: paramStringToObject,\t\r\n\r\n\t// navigate(...args){\r\n\t// \thistoryNavigate(...args);\r\n\t// \treturn this;\r\n\t// },\r\n\r\n\t_routeToRegExp(route) {\r\n\r\n\t\tvar optionalParam = /\\((.*?)\\)/g;\r\n\t\tvar namedParam    = /(\\(\\?)?:\\w+/g;\r\n\t\tvar splatParam    = /\\*\\w+/g;\r\n\t\tvar escapeRegExp  = /[-{}[]+?.,\\\\\\^$|#\\s]/g;\r\n\r\n\t\troute = route.replace(escapeRegExp, '\\\\$&')\r\n\t\t\t.replace(optionalParam, '(?:$1)?')\r\n\t\t\t.replace(namedParam, function(match, optional) {\r\n\t\t\t\treturn optional ? match : '([^/?]+)';\r\n\t\t\t})\r\n\t\t\t.replace(splatParam, '([^?]*?)');\r\n\t\tlet flags = this.getOption('routeCaseInsensitive') ? 'i' : '';\r\n\t\treturn new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$', flags);\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tSome API methods\r\n\t*/\r\n\r\n\tgetContextByFragment(fragment)\t{\r\n\t\tif(!_.isString(fragment)) return;\r\n\t\t//let contexts = this.routeContexts;\r\n\t\t//console.log('Router contexts', contexts);\r\n\t\tlet result = _(this.routeContexts).find((cntx) => cntx.route.test(fragment));\r\n\t\treturn result;\r\n\t}\r\n\r\n\r\n});\r\n\r\nexport default Router;\r\n","import _ from 'underscore';\r\nimport { history } from 'bbmn-core';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\nconst historyApi = {\r\n\t// supports passing options to the callback\r\n\t// by using new version of loadUrl\t\r\n\tnavigate(fragment, opts){\r\n\t\r\n\t\tlet options = opts === true ? { trigger: true }\r\n\t\t\t: _.isObject(opts) ? _.clone(opts)\r\n\t\t\t\t: {};\r\n\t\r\n\t\tlet { trigger } = options;\t\r\n\t\tdelete options.trigger;\r\n\t\r\n\t\thistory.navigate(fragment, options);\r\n\t\r\n\t\tif (trigger) {\r\n\t\t\treturn historyApi.loadUrl(fragment, opts);\r\n\t\t}\r\n\t\r\n\t},\r\n\r\n\t// original loadUrl does not pass options to the callback\r\n\t// and this one does\r\n\tloadUrl(fragment, opts = {}) {\r\n\r\n\t\t// If the root doesn't match, no routes can match either.\r\n\t\tif (!history.matchRoot()) return false;\r\n\r\n\t\tfragment = history.fragment = history.getFragment(fragment);\r\n\r\n\t\tlet executed = historyApi.executeHandler(fragment, opts);\r\n\t\tif (!executed) {\r\n\t\t\terrorHandler.handle('not:found', opts.context, [fragment]);\r\n\t\t}\r\n\t\treturn executed;\r\n\t},\r\n\r\n\t// default test handler\r\n\t//TODO: think about constraints check\r\n\ttestHandler(handler, fragment){\r\n\t\treturn handler.route.test(fragment);\r\n\t},\r\n\r\n\t//also accepts test function, if you wish test handlers by your own\r\n\tfindHandler(fragment, customTest){\r\n\t\tlet test = _.isFunction(customTest) ? customTest : historyApi.testHandler;\r\n\t\tfragment = history.getFragment(fragment);\r\n\t\treturn _.filter(history.handlers || [], handler => test(handler, fragment))[0];\r\n\t},\r\n\r\n\texecuteHandler(fragment, opts = {}, resultContext = {}) {\r\n\t\t\r\n\t\tlet handler = historyApi.findHandler(fragment, opts.testHandler);\r\n\t\t\r\n\t\thandler && (resultContext.value = handler.callback(fragment, opts));\r\n\r\n\t\treturn !!handler;\r\n\t},\r\n\t// this start replaces native history loadUrl and test handler\r\n\tstart(options){\r\n\r\n\t\tif(history.loadUrl !== historyApi.loadUrl)\r\n\t\t\thistory.loadUrl = historyApi.loadUrl;\r\n\t\r\n\t\tlet result = history.start(options);\r\n\r\n\t\treturn result;\r\n\t},\r\n\tisStarted(){\r\n\t\treturn !!history.started;\r\n\t}\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n\thistory,\r\n\thistoryApi\r\n};\r\n","import _ from 'underscore';\r\nimport { Process } from 'bbmn-components';\r\nimport BaseRouter from '../router/router.js';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\nexport default BaseRouter.extend({\r\n\t\r\n\tclassicMode:false,\r\n\tisRouterHoldsActions : false,\r\n\tisRouteChaining: false,\t\r\n\tcallbackAsPromises: true,\r\n\trouteCaseInsensitive: true,\r\n\r\n\tregisterPageRoutes(page){\r\n\t\tlet contexts = page.getRoutesContexts({ reverse: true });\r\n\t\t_.each(contexts, context => {\r\n\t\t\tlet callback = (...args) => {\r\n\t\t\t\treturn this.startPage(page, ...args);\r\n\t\t\t};\r\n\t\t\tthis.addRoute(context.route, context.name, callback);\r\n\t\t});\r\n\t},\r\n\r\n\thandleError(process, action){\r\n\t\tlet args, error;\r\n\r\n\t\tif(process instanceof Process) {\r\n\t\t\targs = [].slice.call(process.errors) ;\r\n\t\t\terror = args.shift();\r\n\t\t\targs.push(action);\r\n\t\t} else {\r\n\t\t\terror = process;\r\n\t\t\targs = [action];\r\n\t\t}\r\n\r\n\t\terrorHandler.handle(error, this, args);\r\n\r\n\t},\r\n\tstartPage(page, ...args){\r\n\t\treturn this.beforePageStart(page)\r\n\t\t\t.then(() => page.start(...args))\r\n\t\t\t.then(() => this.afterPageStart(page, ...args));\r\n\t},\r\n\r\n\tbeforePageStart(){\r\n\t\tif (this.previousPage && this.previousPage.isStarted())\r\n\t\t\treturn this.previousPage.stop();\r\n\t\telse\r\n\t\t\treturn Promise.resolve();\r\n\t},\r\n\r\n\tafterPageStart(page){\r\n\t\tthis.previousPage = page;\r\n\t},\r\n\r\n\trestartLastAttempt(){\r\n\t\tif(this.lastAttempt)\r\n\t\t\treturn this.lastAttempt.restart();\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport { Model, isView, isViewClass } from 'bbmn-core';\r\nimport { betterResult, buildViewByKey, getByPath, getOption, isKnownCtor, mergeOptions } from 'bbmn-utils';\r\nimport $ from 'jquery';\r\n\r\nvar index = (function (CollectionView) {\r\n\treturn CollectionView.extend({\r\n\t\tshouldHandleEmptyFetch: true,\r\n\t\tconstructor: function constructor() {\r\n\t\t\tCollectionView.apply(this, arguments);\r\n\r\n\t\t\tthis.getOption('shouldHandleEmptyFetch') && this.emptyView && this._handleEmptyFetch();\r\n\t\t},\r\n\t\t_handleEmptyFetch: function _handleEmptyFetch() {\r\n\t\t\tvar _this = this;\r\n\r\n\t\t\tif (!this.collection || this.collection.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.listenToOnce(this.collection, 'sync', function () {\r\n\t\t\t\treturn !_this.collection.length && _this._renderChildren();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n});\r\n\r\nfunction rebuildIndexes() {\r\n\tif (!this.getOption('shouldRebuildIndexes') || !this.collection) {\r\n\t\treturn;\r\n\t}\r\n\tvar models = this.collection.models;\r\n\tfor (var index = 0, length = models.length; index < length; index++) {\r\n\t\tvar model = models[index];\r\n\t\tvar view = this._children.findByModel(model);\r\n\t\tview && (view._index = index);\r\n\t}\r\n}\r\n\r\nvar index$1 = (function (CollectionView) {\r\n\treturn CollectionView.extend({\r\n\t\tshouldRebuildIndexes: true,\r\n\r\n\t\tconstructor: function constructor() {\r\n\r\n\t\t\tCollectionView.apply(this, arguments);\r\n\t\t\tthis.on('before:sort', rebuildIndexes.bind(this));\r\n\t\t},\r\n\t\t_addChild: function _addChild(view, index) {\r\n\t\t\tview._isModelView = arguments.length === 1;\r\n\t\t\tif (index != null) {\r\n\t\t\t\tview._index = index;\r\n\t\t\t}\r\n\t\t\treturn CollectionView.prototype._addChild.apply(this, arguments);\r\n\t\t},\r\n\t\t_viewComparator: function _viewComparator(v1, v2) {\r\n\t\t\tvar res = v1._index - v2._index;\r\n\t\t\tif (res) return res;\r\n\t\t\tif (v1._isModelView) return 1;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t});\r\n});\r\n\r\nvar index$2 = (function (CollectionView) {\r\n\treturn CollectionView.extend({\r\n\t\t_renderChildren: function _renderChildren() {\r\n\t\t\t// If there are unrendered views prevent add to end perf\r\n\t\t\tif (this._hasUnrenderedViews) {\r\n\t\t\t\tdelete this._addedViews;\r\n\t\t\t\tdelete this._hasUnrenderedViews;\r\n\t\t\t}\r\n\r\n\t\t\tvar views = this._addedViews || this.children._views;\r\n\r\n\t\t\tthis.triggerMethod('before:render:children', this, views);\r\n\r\n\t\t\tthis._showEmptyView();\r\n\r\n\t\t\tvar els = this._getBuffer(views);\r\n\r\n\t\t\tthis._attachChildren(els, views);\r\n\r\n\t\t\tdelete this._addedViews;\r\n\r\n\t\t\tthis.triggerMethod('render:children', this, views);\r\n\t\t},\r\n\t\taddChildView: function addChildView(view, index) {\r\n\t\t\tvar options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\r\n\r\n\t\t\tif (!view || view._isDestroyed) {\r\n\t\t\t\treturn view;\r\n\t\t\t}\r\n\r\n\t\t\tif (_.isObject(index)) {\r\n\t\t\t\toptions = index;\r\n\t\t\t}\r\n\r\n\t\t\t// If options has defined index we should use it\r\n\t\t\tif (options.index != null) {\r\n\t\t\t\tindex = options.index;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._isRendered && !options.preventRender) {\r\n\t\t\t\tthis.render();\r\n\t\t\t}\r\n\r\n\t\t\tthis._addChild(view, index);\r\n\r\n\t\t\tif (options.preventRender) {\r\n\t\t\t\tthis._hasUnrenderedViews = true;\r\n\t\t\t\treturn view;\r\n\t\t\t}\r\n\r\n\t\t\tvar hasIndex = typeof index !== 'undefined';\r\n\t\t\tvar isAddedToEnd = !hasIndex || index >= this._children.length;\r\n\r\n\t\t\t// Only cache views if added to the end and there is no unrendered views\r\n\t\t\tif (isAddedToEnd && !this._hasUnrenderedViews) {\r\n\t\t\t\tthis._addedViews = [view];\r\n\t\t\t}\r\n\r\n\t\t\tif (hasIndex) {\r\n\t\t\t\tthis._renderChildren();\r\n\t\t\t} else {\r\n\t\t\t\tthis.sort();\r\n\t\t\t}\r\n\r\n\t\t\treturn view;\r\n\t\t},\r\n\t\t_showEmptyView: function _showEmptyView() {\r\n\r\n\t\t\tthis._destroyEmptyView();\r\n\r\n\t\t\tif (!this.isEmpty()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar EmptyView = this._getEmptyView();\r\n\t\t\tif (!EmptyView) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar options = this._getEmptyViewOptions();\r\n\t\t\tthis._emptyViewInstance = new EmptyView(options);\r\n\r\n\t\t\tthis.addChildView(this._emptyViewInstance, { preventRender: true, index: 0 });\r\n\t\t},\r\n\t\t_destroyEmptyView: function _destroyEmptyView() {\r\n\t\t\tvar view = this._emptyViewInstance;\r\n\t\t\tif (!view) return;\r\n\r\n\t\t\tthis._removeChildView(view);\r\n\r\n\t\t\tthis._removeChild(view);\r\n\r\n\t\t\tview.destroy();\r\n\t\t\tdelete this._emptyViewInstance;\r\n\t\t}\r\n\t}, { CollectionViewMixin_4x: true });\r\n});\r\n\r\nvar slicedToArray = function () {\r\n  function sliceIterator(arr, i) {\r\n    var _arr = [];\r\n    var _n = true;\r\n    var _d = false;\r\n    var _e = undefined;\r\n\r\n    try {\r\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\r\n        _arr.push(_s.value);\r\n\r\n        if (i && _arr.length === i) break;\r\n      }\r\n    } catch (err) {\r\n      _d = true;\r\n      _e = err;\r\n    } finally {\r\n      try {\r\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\r\n      } finally {\r\n        if (_d) throw _e;\r\n      }\r\n    }\r\n\r\n    return _arr;\r\n  }\r\n\r\n  return function (arr, i) {\r\n    if (Array.isArray(arr)) {\r\n      return arr;\r\n    } else if (Symbol.iterator in Object(arr)) {\r\n      return sliceIterator(arr, i);\r\n    } else {\r\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\r\n    }\r\n  };\r\n}();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar toConsumableArray = function (arr) {\r\n  if (Array.isArray(arr)) {\r\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\r\n\r\n    return arr2;\r\n  } else {\r\n    return Array.from(arr);\r\n  }\r\n};\r\n\r\nvar index$3 = (function (Base) {\r\n\treturn Base.extend({\r\n\r\n\t\trenderAllCustoms: false,\r\n\t\tshouldMergeCustoms: false,\r\n\t\trenderCollection: true,\r\n\r\n\t\tconstructor: function constructor() {\r\n\t\t\tthis._customs = [];\r\n\t\t\tBase.apply(this, arguments);\r\n\t\t\tif (this.getOption('renderCollection') === false && this.collection) {\r\n\t\t\t\tthis._collection = this.collection;\r\n\t\t\t\tdelete this.collection;\r\n\t\t\t}\r\n\t\t\tthis._initializeCustoms();\r\n\t\t},\r\n\t\tgetCollection: function getCollection() {\r\n\t\t\treturn this.collection || this._collection;\r\n\t\t},\r\n\t\t_initializeCustoms: function _initializeCustoms() {\r\n\t\t\tvar _customs;\r\n\r\n\t\t\tvar optionsCustoms = betterResult(this.options, 'customs', { args: [this], context: this });\r\n\t\t\tvar instanceCustoms = betterResult(this, 'customs', { args: [this] });\r\n\t\t\tvar shouldMergeCustoms = this.getOption('shouldMergeCustoms');\r\n\t\t\tvar add = void 0;\r\n\t\t\tif (shouldMergeCustoms) {\r\n\t\t\t\tadd = (instanceCustoms || []).concat(optionsCustoms || []);\r\n\t\t\t} else {\r\n\t\t\t\tadd = instanceCustoms || optionsCustoms || [];\r\n\t\t\t}\r\n\t\t\t(_customs = this._customs).push.apply(_customs, toConsumableArray(add));\r\n\r\n\t\t\tif (this.getOption('renderAllCustoms')) {\r\n\t\t\t\tthis.on('render', this._renderCustoms);\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderCustoms: function renderCustoms() {\r\n\t\t\tthis.triggerMethod('before:customs:render');\r\n\r\n\t\t\t_.each(this._renderedCustoms, function (view) {\r\n\t\t\t\treturn view.destroy();\r\n\t\t\t});\r\n\r\n\t\t\tvar customs = this.getCustoms();\r\n\r\n\t\t\tthis._renderedCustoms = this.addChildViews(customs);\r\n\r\n\t\t\tthis.triggerMethod('customs:render');\r\n\t\t},\r\n\t\t_renderCustoms: function _renderCustoms() {\r\n\t\t\tif (!this.getOption('renderAllCustoms')) return;\r\n\t\t\tthis.renderCustoms();\r\n\t\t},\r\n\t\tgetCustoms: function getCustoms() {\r\n\t\t\treturn this._prepareCustoms(this._customs.slice(0));\r\n\t\t},\r\n\t\t_prepareCustoms: function _prepareCustoms(rawcustoms) {\r\n\t\t\tvar _this = this;\r\n\r\n\t\t\treturn _.reduce(rawcustoms, function (array, item) {\r\n\t\t\t\tvar args = _this._prepareCustom(item);\r\n\t\t\t\targs && (args = _this.buildCustom.apply(_this, toConsumableArray(args)));\r\n\t\t\t\targs && array.push(args);\r\n\t\t\t\treturn array;\r\n\t\t\t}, []);\r\n\t\t},\r\n\t\t_prepareCustom: function _prepareCustom(arg) {\r\n\t\t\tif (_.isFunction(arg)) {\r\n\t\t\t\treturn this._prepareCustom(arg.call(this, this));\r\n\t\t\t} else if (_.isArray(arg)) {\r\n\t\t\t\treturn arg;\r\n\t\t\t} else {\r\n\t\t\t\treturn [arg, { index: 0 }];\r\n\t\t\t}\r\n\t\t},\r\n\t\tbuildCustom: function buildCustom(view) {\r\n\t\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n\r\n\t\t\tif (isViewClass(view)) {\r\n\t\t\t\tvar childOptions = this.getOption('customViewOptions');\r\n\t\t\t\tview = new view(childOptions);\r\n\t\t\t} else if (_.isFunction(view)) {\r\n\t\t\t\tview = view.call(this, this);\r\n\t\t\t} else if (!isView(view) && _.isObject(view) && 'view' in view) {\r\n\t\t\t\tif (isView(view.view)) {\r\n\t\t\t\t\tif (_.isObject(view.options)) options = view.options;\r\n\t\t\t\t\tview = view.view;\r\n\t\t\t\t} else if (isViewClass(view.view)) {\r\n\t\t\t\t\tvar viewOptions = view.options;\r\n\t\t\t\t\tview = new view.view(viewOptions);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (isView(view)) {\r\n\t\t\t\tthis._setupCustom(view);\r\n\t\t\t\treturn [view, options];\r\n\t\t\t}\r\n\t\t},\r\n\t\t_setupCustom: function _setupCustom(view) {\r\n\t\t\tthis.setupCustom(view);\r\n\t\t},\r\n\r\n\t\tsetupCustom: _.noop,\r\n\t\taddChildViews: function addChildViews() {\r\n\t\t\tvar children = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n\r\n\t\t\tif (!children.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar awaitingRender = false;\r\n\t\t\tvar rendered = [];\r\n\t\t\twhile (children.length) {\r\n\r\n\t\t\t\tvar args = children.pop();\r\n\t\t\t\tif (!args) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!_.isArray(args)) {\r\n\t\t\t\t\targs = [args, { index: 0 }];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar _args = args,\r\n\t\t\t\t    _args2 = slicedToArray(_args, 3),\r\n\t\t\t\t    view = _args2[0],\r\n\t\t\t\t    index = _args2[1],\r\n\t\t\t\t    _args2$ = _args2[2],\r\n\t\t\t\t    options = _args2$ === undefined ? {} : _args2$;\r\n\r\n\t\t\t\tif (_.isObject(index)) {\r\n\t\t\t\t\toptions = index;\r\n\t\t\t\t\tindex = undefined;\r\n\t\t\t\t}\r\n\t\t\t\tif (index != null && !('index' in options)) {\r\n\t\t\t\t\toptions.index = index;\r\n\t\t\t\t}\r\n\t\t\t\toptions.preventRender = !!children.length;\r\n\t\t\t\tif (!isView(view)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.addChildView(view, options);\r\n\t\t\t\trendered.push(view);\r\n\t\t\t\tawaitingRender = options.preventRender;\r\n\t\t\t}\r\n\t\t\tif (awaitingRender) {\r\n\t\t\t\tthis.sort();\r\n\t\t\t}\r\n\t\t\treturn rendered;\r\n\t\t}\r\n\t}, { CustomsMixin: true });\r\n});\r\n\r\nvar index$4 = (function (Collection) {\r\n\treturn Collection.extend({\r\n\t\tconstructor: function constructor() {\r\n\r\n\t\t\tthis.on({\r\n\t\t\t\trequest: function request() {\r\n\t\t\t\t\tthis._isFetching = true;\r\n\t\t\t\t},\r\n\t\t\t\tsync: function sync() {\r\n\t\t\t\t\tthis._isFetching = false;\r\n\t\t\t\t\tthis._isFetched = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tCollection.apply(this, arguments);\r\n\t\t},\r\n\t\tisFetching: function isFetching() {\r\n\t\t\treturn this._isFetching === true;\r\n\t\t},\r\n\t\tisFetched: function isFetched() {\r\n\t\t\treturn this._isFetched === true;\r\n\t\t}\r\n\t});\r\n});\r\n\r\nvar index$5 = (function (Base) {\r\n\treturn Base.extend({\r\n\t\tconstructor: function constructor(opts) {\r\n\r\n\t\t\tBase.apply(this, arguments);\r\n\t\t\tthis._initializeChildrenable(opts);\r\n\t\t},\r\n\t\t_initializeChildrenable: function _initializeChildrenable(opts) {\r\n\t\t\tmergeOptions(opts, ['parent', 'root']);\r\n\t\t\tif (this.parent == null && this.root == null) this.root = this;\r\n\t\t},\r\n\r\n\r\n\t\t//call this method manualy for initialize children\r\n\t\tinitializeChildren: function initializeChildren() {\r\n\t\t\tvar _this = this;\r\n\r\n\t\t\tif (this._childrenInitialized) return;\r\n\r\n\t\t\tvar children = getOption(this, 'children');\r\n\t\t\tthis._children = [];\r\n\t\t\t_(children).each(function (child) {\r\n\t\t\t\treturn _this._initializeChild(child);\r\n\t\t\t});\r\n\r\n\t\t\tthis._childrenInitialized = true;\r\n\t\t},\r\n\t\t_initializeChild: function _initializeChild(arg) {\r\n\t\t\tvar Child = void 0;\r\n\t\t\tvar options = {};\r\n\r\n\t\t\tif (isKnownCtor(arg)) Child = arg;else if (_.isFunction(arg)) {\r\n\r\n\t\t\t\tvar invoked = arg.call(this, this);\r\n\t\t\t\treturn this._initializeChild(invoked);\r\n\t\t\t} else if (_.isObject(arg)) {\r\n\t\t\t\tChild = arg.Child;\r\n\t\t\t\t_.extend(options, _.omit(arg, 'Child'));\r\n\t\t\t}\r\n\r\n\t\t\t_.extend(options, getOption(this, 'childOptions'), { parent: this });\r\n\t\t\toptions = this.buildChildOptions(options);\r\n\r\n\t\t\tvar child = this.buildChild(Child, options);\r\n\t\t\tthis._children.push(child);\r\n\t\t},\r\n\t\tbuildChildOptions: function buildChildOptions(options) {\r\n\t\t\treturn options;\r\n\t\t},\r\n\t\tbuildChild: function buildChild(Child, options) {\r\n\t\t\t!Child && (Child = getOption(this, 'defaultChildClass') || this.prototype.constructor);\r\n\t\t\treturn new Child(options);\r\n\t\t},\r\n\t\t_getChildren: function _getChildren(items) {\r\n\t\t\tvar _this2 = this;\r\n\r\n\t\t\tvar opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n\t\t\tvar exclude = opts.exclude,\r\n\t\t\t    filter = opts.filter,\r\n\t\t\t    map = opts.map;\r\n\r\n\r\n\t\t\tif (exclude != null && !_.isArray(exclude)) opts.exclude = [exclude];\r\n\r\n\t\t\tif (!_.isFunction(filter)) delete opts.filter;\r\n\r\n\t\t\tvar result = [];\r\n\t\t\t_(items).each(function (item, index) {\r\n\r\n\t\t\t\tif (!_this2._childFilter(item, index, opts)) return;\r\n\r\n\t\t\t\tif (_.isFunction(map)) item = map(item);\r\n\r\n\t\t\t\titem && result.push(item);\r\n\t\t\t});\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\t_childFilter: function _childFilter(item, index) {\r\n\t\t\tvar opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\r\n\r\n\r\n\t\t\tif (opts.force) return item;\r\n\r\n\t\t\tvar exclude = opts.exclude,\r\n\t\t\t    filter = opts.filter;\r\n\r\n\r\n\t\t\tif (_.isFunction(this.childFilter) && !this.childFilter(item, index, opts)) return;\r\n\r\n\t\t\tif (_.isArray(exclude) && exclude.indexOf(item) >= 0) return;\r\n\r\n\t\t\tif (_.isFunction(filter) && !filter.call(this, item, index, opts)) return;\r\n\r\n\t\t\treturn item;\r\n\t\t},\r\n\r\n\t\tchildFilter: false,\r\n\t\tgetChildren: function getChildren() {\r\n\t\t\tvar opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\r\n\r\n\t\t\tvar children = [].slice.call(this._children || []);\r\n\t\t\topts.reverse && children.length > 1 && children.reverse();\r\n\t\t\treturn this._getChildren(children, opts);\r\n\t\t},\r\n\t\tgetAllChildren: function getAllChildren() {\r\n\t\t\tvar opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\r\n\t\t\tvar includeSelf = opts.includeSelf,\r\n\t\t\t    map = opts.map,\r\n\t\t\t    reverse = opts.reverse;\r\n\r\n\t\t\tvar options = _.omit(opts, 'includeSelf', 'map');\r\n\r\n\t\t\tvar children = this.getChildren(options);\r\n\t\t\tvar result = _(children).chain().map(function (child) {\r\n\t\t\t\tvar children = child.getAllChildren(options);\r\n\t\t\t\treturn reverse ? [children, child] : [child, children];\r\n\t\t\t}).flatten().value();\r\n\r\n\t\t\tif (includeSelf) {\r\n\t\t\t\tvar method = reverse ? 'push' : 'unshift';\r\n\t\t\t\tresult[method](this);\r\n\t\t\t}\r\n\r\n\t\t\tif (_.isFunction(map)) {\r\n\t\t\t\treturn _(result).chain().map(map).filter(function (f) {\r\n\t\t\t\t\treturn !!f;\r\n\t\t\t\t}).value();\r\n\t\t\t} else {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetParent: function getParent() {\r\n\t\t\treturn this.parent;\r\n\t\t}\r\n\t}, { ChildrenableMixin: true });\r\n});\r\n\r\n//import getOptionMixin from './get-option/index.js';\r\n\r\nfunction getNestedResult(value, context, schema) {\r\n\treturn value != null && _.isFunction(schema.nested) && schema.nested(value, context);\r\n}\r\n\r\nfunction getPropertySchema(model, key) {\r\n\tif (_.isFunction(model.getPropertySchema)) {\r\n\t\treturn model.getPropertySchema(key);\r\n\t} else {\r\n\t\treturn {};\r\n\t}\r\n}\r\n\r\nfunction getDisplayConfig(key, model, schema) {\r\n\tif (key == null) return {};\r\n\treturn _.isFunction(model.getPropertyDisplayConfig) && model.getPropertyDisplayConfig(key) || schema && schema.display || {};\r\n}\r\n\r\nvar index$6 = (function (Base) {\r\n\tvar originalGet = Model.prototype.get;\r\n\tvar Mixed = Base.extend({\r\n\t\tgetByPath: function getByPath$$1(key) {\r\n\t\t\tif (key.indexOf('.') > -1) return getByPath(this, key);else return originalGet.call(this, key);\r\n\t\t},\r\n\t\tget: function get(key) {\r\n\t\t\tvar opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n\r\n\t\t\tif (key == null || key == '') return;\r\n\r\n\t\t\tvar value = 'value' in opts ? opts.value : this.getByPath.call(this, key);\r\n\r\n\t\t\tif (!_.size(opts)) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tvar prop = getPropertySchema(this, key);\r\n\t\t\tvar result = opts.nested && getNestedResult(value, this, prop);\r\n\t\t\tif (result != null) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tif (_.isFunction(opts.transform) && !opts.raw) {\r\n\t\t\t\tvalue = opts.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (_.isFunction(prop.transform) && !opts.raw) {\r\n\t\t\t\tvalue = prop.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (opts.display === true) {\r\n\r\n\t\t\t\tvar display = getDisplayConfig(key, this, prop);\r\n\r\n\t\t\t\tif (opts.alternative) {\r\n\t\t\t\t\tvalue = _.isFunction(display.alternative) && display.alternative.call(this, value, _.extend({}, opts, prop), this);\r\n\t\t\t\t} else if (_.isFunction(display.transform)) {\r\n\t\t\t\t\tvalue = display.transform.call(this, value, opts, this);\r\n\t\t\t\t}\r\n\t\t\t\tif (display.ifEmpty && (value == null || value === '')) return display.ifEmpty;\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tdisplay: function display(key) {\r\n\t\t\tvar opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n\r\n\t\t\t_.extend(opts, { display: true });\r\n\t\t\treturn this.get(key, opts);\r\n\t\t},\r\n\t\tpropertyName: function propertyName(key) {\r\n\t\t\tvar prop = getPropertySchema(this, key);\r\n\t\t\tvar display = getDisplayConfig(key, this, prop);\r\n\t\t\treturn display.label || key;\r\n\t\t}\r\n\t});\r\n\r\n\treturn Mixed;\r\n});\r\n\r\nvar index$7 = (function (Base) {\r\n\treturn Base.extend({\r\n\t\tbuildViewByKey: function buildViewByKey$$1() {\r\n\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\r\n\t\t\t\targs[_key] = arguments[_key];\r\n\t\t\t}\r\n\r\n\t\t\treturn buildViewByKey.call.apply(buildViewByKey, [this].concat(toConsumableArray(args)));\r\n\t\t}\r\n\t});\r\n});\r\n\r\nvar defaultCssConfig = {\r\n\tbeforeRender: true,\r\n\tmodelChange: true,\r\n\trefresh: true\r\n};\r\n\r\nvar index$8 = (function (Base) {\r\n\treturn Base.extend({\r\n\t\tconstructor: function constructor() {\r\n\t\t\tif (!this.cssClassModifiers) {\r\n\t\t\t\tthis.cssClassModifiers = [];\r\n\t\t\t}\r\n\t\t\tBase.apply(this, arguments);\r\n\t\t\tthis._setupCssClassModifiers();\r\n\t\t},\r\n\t\taddCssClassModifier: function addCssClassModifier() {\r\n\t\t\tvar _cssClassModifiers;\r\n\r\n\t\t\t(_cssClassModifiers = this.cssClassModifiers).push.apply(_cssClassModifiers, arguments);\r\n\t\t},\r\n\t\trefreshCssClass: function refreshCssClass() {\r\n\t\t\tvar className = this._getCssClassString();\r\n\t\t\tif (className == '') {\r\n\t\t\t\tthis.$el.removeAttr('class');\r\n\t\t\t} else {\r\n\t\t\t\tthis.$el.attr({\r\n\t\t\t\t\tclass: className\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t_getCssClassModifiers: function _getCssClassModifiers() {\r\n\t\t\tvar optsModifiers = betterResult(this.options || {}, 'cssClassModifiers', { args: [this.model, this], default: [] });\r\n\t\t\tvar propsModifiers = betterResult(this, 'cssClassModifiers', { args: [this.model, this], default: [] });\r\n\t\t\tvar className = betterResult(this, 'className', { args: [this.model, this], default: [] });\r\n\t\t\tvar modifiers = [className].concat(optsModifiers, propsModifiers);\r\n\t\t\treturn modifiers;\r\n\t\t},\r\n\r\n\t\t//override this if you need other logic\r\n\t\tgetCssClassModifiers: function getCssClassModifiers() {\r\n\t\t\treturn this._getCssClassModifiers();\r\n\t\t},\r\n\t\t_getCssClassString: function _getCssClassString() {\r\n\t\t\tvar _this = this;\r\n\r\n\t\t\tvar modifiers = this.getCssClassModifiers();\r\n\r\n\t\t\tvar classes = _(modifiers).reduce(function (hash, modifier) {\r\n\t\t\t\tif (modifier == null || modifier === '') {\r\n\t\t\t\t\treturn hash;\r\n\t\t\t\t}\r\n\t\t\t\tvar cls = void 0;\r\n\t\t\t\tif (_.isString(modifier)) {\r\n\t\t\t\t\tcls = modifier;\r\n\t\t\t\t} else if (_.isFunction(modifier)) {\r\n\t\t\t\t\tvar builded = modifier.call(_this, _this.model, _this);\r\n\t\t\t\t\tcls = _.isString(builded) && builded || undefined;\r\n\t\t\t\t}\r\n\t\t\t\tcls && (hash[cls] = true);\r\n\t\t\t\treturn hash;\r\n\t\t\t}, {});\r\n\r\n\t\t\treturn _.keys(classes).join(' ');\r\n\r\n\t\t\t// return _.chain(classes)\r\n\t\t\t// \t.keys(classes)\r\n\t\t\t// \t.uniq()\r\n\t\t\t// \t.value()\r\n\t\t\t// \t.join(' ');\r\n\t\t},\r\n\t\t_setupCssClassModifiers: function _setupCssClassModifiers() {\r\n\t\t\tvar _this2 = this;\r\n\r\n\t\t\tif (this._cssClassModifiersInitialized) return;\r\n\r\n\t\t\tvar cfg = this.getCssClassConfig();\r\n\t\t\tif (!cfg) return;\r\n\r\n\t\t\tvar events = this.getCssClassEvents(cfg);\r\n\t\t\t_(events).each(function (eventName) {\r\n\t\t\t\treturn _this2.on(eventName, _this2.refreshCssClass);\r\n\t\t\t});\r\n\r\n\t\t\tif (cfg.modelChange && this.model) {\r\n\t\t\t\tthis.listenTo(this.model, 'change', this.refreshCssClass);\r\n\t\t\t}\r\n\r\n\t\t\tthis._cssClassModifiersInitialized = true;\r\n\t\t},\r\n\t\t_getCssClassConfig: function _getCssClassConfig() {\r\n\t\t\tvar cfg = _.extend({}, defaultCssConfig, this.getOption('cssClassConfig'));\r\n\t\t\tif (!cfg || _.size(cfg) == 0) return;\r\n\t\t\treturn cfg;\r\n\t\t},\r\n\r\n\t\t//override this if you need other logic\r\n\t\tgetCssClassConfig: function getCssClassConfig() {\r\n\t\t\treturn this._getCssClassConfig();\r\n\t\t},\r\n\t\t_getCssClassEvents: function _getCssClassEvents(cfg) {\r\n\t\t\tvar events = [].concat(cfg.events || []);\r\n\t\t\tif (cfg.refresh) events.push('refresh');\r\n\t\t\tif (cfg.beforeRender) events.push('before:render');\r\n\t\t\tevents = _(events).uniq();\r\n\t\t\treturn events;\r\n\t\t},\r\n\r\n\t\t//override this if you need other logic\r\n\t\tgetCssClassEvents: function getCssClassEvents(cfg) {\r\n\t\t\treturn this._getCssClassEvents(cfg);\r\n\t\t}\r\n\t}, { CssClassModifiersMixin: true });\r\n});\r\n\r\nvar index$9 = (function (Base) {\r\n\treturn Base.extend({\r\n\t\tdestroy: function destroy() {\r\n\t\t\tif (this._isDestroyed || this._isDestroying) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._isDestroying = true;\r\n\t\t\tBase.prototype.destroy.apply(this, arguments);\r\n\t\t\tdelete this._isDestroying;\r\n\t\t},\r\n\t\tisDestroyed: function isDestroyed() {\r\n\t\t\treturn this._isDestroyed || this._isDestroying;\r\n\t\t}\r\n\t}, { DestroyMixin: true });\r\n});\r\n\r\nvar defaultSelector = function defaultSelector(name) {\r\n\tvar prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\r\n\treturn prefix + 'region-' + name;\r\n};\r\n\r\nfunction defaultUpdateDom(name, $el) {\r\n\tvar selector = defaultSelector(name);\r\n\tvar element = $('<div>').addClass(selector);\r\n\t$el.append(element);\r\n\r\n\treturn '.' + selector;\r\n}\r\n\r\nfunction buildRegionFunc(view, hash, context) {\r\n\tvar $el = view.$el;\r\n\tvar autoCreateRegion = context.autoCreateRegion;\r\n\tvar updateDom = hash.updateDom,\r\n\t    name = hash.name,\r\n\t    el = hash.el;\r\n\r\n\tvar regionEl = void 0;\r\n\r\n\tvar region = view.getRegion(name);\r\n\r\n\tif (el == null && autoCreateRegion !== false) {\r\n\r\n\t\tvar testEl = region && region.getOption('el', { deep: false });\r\n\r\n\t\tif (!region || !testEl || !$el.find(testEl).length) {\r\n\r\n\t\t\tregionEl = defaultUpdateDom(name, $el);\r\n\t\t}\r\n\t} else if (_.isFunction(updateDom)) {\r\n\t\tupdateDom.call(view, $el, view);\r\n\t}\r\n\r\n\tif (!region) {\r\n\t\tvar definition = _.pick(hash, 'replaceElement', 'regionClass');\r\n\t\tdefinition.el = hash.el || regionEl;\r\n\t\tregion = view.addRegion(name, definition);\r\n\t}\r\n\r\n\treturn region;\r\n}\r\n\r\nfunction normalizeNestedViewContextRegion(context) {\r\n\tvar region = context.region;\r\n\r\n\tvar regionName = _.isString(region) && region || context.regionName || context.name;\r\n\r\n\tif (_.isString(region) || region == null) {\r\n\t\tregion = {};\r\n\t} else if (_.isFunction(region)) {\r\n\t\tregion = region.call(this, context, this);\r\n\t}\r\n\r\n\tif (_.isObject(region)) {\r\n\r\n\t\tif (!region.name) region.name = regionName;\r\n\t\tvar replaceElement = this.getOption('replaceNestedElement');\r\n\t\tcontext.region = _.extend({ replaceElement: replaceElement }, region);\r\n\t\tcontext.show = _.partial(buildRegionFunc, this, context.region, context);\r\n\t}\r\n\treturn context;\r\n}\r\n\r\nvar index$10 = (function (Base) {\r\n\treturn Base.extend({\r\n\t\tconstructor: function constructor() {\r\n\t\t\tthis._nestedViews = {};\r\n\t\t\tBase.apply(this, arguments);\r\n\t\t\tthis.initializeNestedViews();\r\n\t\t},\r\n\r\n\t\ttemplate: false,\r\n\r\n\t\tshowAllNestedViewsOnRender: false,\r\n\t\tshowNestedViewOnAdd: false,\r\n\t\treplaceNestedElement: true,\r\n\r\n\t\tinitializeNestedViews: function initializeNestedViews() {\r\n\t\t\tvar _this = this;\r\n\r\n\t\t\tif (this._nestedViewsInitialized) return;\r\n\r\n\t\t\tif (this.getOption('showAllNestedViewsOnRender')) {\r\n\t\t\t\tthis.on('render', function () {\r\n\t\t\t\t\treturn _this.showAllNestedViews();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tvar nesteds = this.getOption('nestedViews', { args: [this.model, this] });\r\n\t\t\t_(nesteds).each(function (context, index) {\r\n\r\n\t\t\t\tvar name = _.isString(index) ? index : context.name || _.uniqueId('nested');\r\n\t\t\t\t_this.addNestedView(name, context);\r\n\t\t\t});\r\n\r\n\t\t\tthis._nestedViewsInitialized = true;\r\n\t\t},\r\n\t\t_normalizeNestedContext: function _normalizeNestedContext(name, context) {\r\n\r\n\t\t\tif (isViewClass(context)) {\r\n\t\t\t\tvar View = context;\r\n\t\t\t\tcontext = {\r\n\t\t\t\t\tname: name, View: View\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t//unwrap to plain object\r\n\t\t\tif (_.isFunction(context)) {\r\n\t\t\t\tcontext = context.call(this, this.model, this);\r\n\t\t\t}\r\n\r\n\t\t\t//fix name if its not provided\r\n\t\t\tif (context.name == null) {\r\n\t\t\t\tcontext.name = name || _.uniqueId('nested');\r\n\t\t\t}\r\n\r\n\t\t\t//convert region to valid function\r\n\t\t\tcontext = normalizeNestedViewContextRegion.call(this, context);\r\n\r\n\t\t\treturn context;\r\n\t\t},\r\n\t\t_createNestedContext: function _createNestedContext(context) {\r\n\t\t\tvar contexts = this.getNestedViewContext();\r\n\t\t\tcontexts[context.name] = context;\r\n\t\t},\r\n\t\taddNestedView: function addNestedView(name, context) {\r\n\r\n\t\t\tif (!_.isString(name) || name === '') {\r\n\t\t\t\tthrow new Error('addNestedView: first argument should be a string');\r\n\t\t\t}\r\n\r\n\t\t\tcontext = this._normalizeNestedContext(name, context);\r\n\t\t\tthis._createNestedContext(context);\r\n\t\t\tif (this.getOption('showNestedViewOnAdd') && this.isRendered()) {\r\n\t\t\t\tthis.showNestedView(context);\r\n\t\t\t}\r\n\t\t},\r\n\t\tshowNestedView: function showNestedView(name) {\r\n\t\t\tvar region = this.getNestedViewRegion(name);\r\n\t\t\tvar view = region && this.buildNestedView(name);\r\n\t\t\tif (view) {\r\n\t\t\t\tregion.show(view);\r\n\t\t\t}\r\n\t\t},\r\n\t\tshowAllNestedViews: function showAllNestedViews() {\r\n\t\t\tvar _this2 = this;\r\n\r\n\t\t\tvar contexts = this.getNestedViewContext();\r\n\t\t\t_(contexts).each(function (context) {\r\n\t\t\t\treturn _this2.showNestedView(context);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetNestedViewContext: function getNestedViewContext(name) {\r\n\t\t\tvar contexts = this._nestedViews;\r\n\t\t\tif (arguments.length == 0) return contexts;else return contexts[name];\r\n\t\t},\r\n\t\tbuildNestedView: function buildNestedView(name) {\r\n\r\n\t\t\tvar context = _.isObject(name) ? name : _.isString(name) ? this.getNestedViewContext(name) : null;\r\n\r\n\t\t\tif (!context) return;\r\n\t\t\tvar passedView = betterResult(context, 'view', { context: this, args: [this, this.model] });\r\n\t\t\tif (_.isFunction(context.template)) return context.template;else if (isView(passedView)) {\r\n\t\t\t\treturn passedView;\r\n\t\t\t} else {\r\n\t\t\t\tvar View = context.View;\r\n\t\t\t\tvar options = this.buildNestedViewOptions(betterResult(context, 'options', { context: this, args: [this, this.model], default: {} }));\r\n\r\n\t\t\t\treturn new View(options);\r\n\t\t\t}\r\n\t\t},\r\n\t\tbuildNestedViewOptions: function buildNestedViewOptions(opts) {\r\n\t\t\treturn opts;\r\n\t\t},\r\n\t\tgetNestedViewRegion: function getNestedViewRegion(name) {\r\n\t\t\tvar context = _.isObject(name) ? name : _.isString(name) ? this.getNestedViewContext(name) : null;\r\n\t\t\treturn context && _.result(context, 'show');\r\n\t\t}\r\n\t});\r\n});\r\n\r\nexport { index as emptyFetchMixin, index$1 as improvedIndexesMixin, index$2 as nextCollectionViewMixin, index$3 as customsMixin, index$4 as isFetchingMixin, index$5 as childrenableMixin, index$6 as smartGetMixin, index$8 as cssClassModifiersMixin, index$10 as nestedViewsMixin, index$9 as destroyView, index$7 as buildViewByKeyMixin };\r\n\r\n//# sourceMappingURL=index.js.map\r\n","import _ from 'underscore';\r\nimport PageRouter from './page-router.js';\r\nimport { comparator } from 'bbmn-utils';\r\n\r\nexport default {\r\n\tinitializeRoutes(){\r\n\t\tif (this.initializeRouter()) {\r\n\t\t\tthis._buildRoutesContexts();\r\n\t\t}\r\n\t},\r\n\tinitializeRouter(){\t\t\r\n\t\tif(this.getOption('shouldCreateRouter') && !this.router) {\r\n\t\t\tthis.router = this._createRouter();\r\n\t\t\tthis._shouldRegisterAllRoutes = true;\r\n\t\t}\r\n\r\n\t\tif(this.getOption('shouldRegisterAllRoutes')) {\r\n\t\t\tthis._shouldRegisterAllRoutes = true;\r\n\t\t}\r\n\r\n\t\treturn !!this.router;\r\n\t},\r\n\t_createRouter(){\r\n\t\tlet Router = this.getOption('Router') || PageRouter;\r\n\t\tlet options = _.extend({}, this.getOption('routerOptions'));\r\n\t\treturn new Router(options);\r\n\t},\r\n\tregisterAllRoutes(){\r\n\t\tif(!this._shouldRegisterAllRoutes) return;\r\n\r\n\t\tlet pages = this.getAllChildren({ reverse: true, includeSelf: true, force: true });\r\n\t\t\r\n\t\tlet router = this.router;\r\n\t\t_(pages).each(page => router.registerPageRoutes(page));\r\n\t\t\r\n\t},\r\n\t_buildRoutesContexts(){\r\n\t\tlet routes = this.getOption('routes', {args: [this]});\r\n\t\tif (routes == null) return;\r\n\t\tif(_.isString(routes))\r\n\t\t\troutes = [routes];\r\n\r\n\t\tlet result = [];\r\n\t\tlet config = this.getRoutesConfig();\r\n\t\t_(routes).each((route, index) => {\r\n\t\t\tlet context = this._normalizeRoutesContextRoute(route, index, config);\r\n\t\t\t_.isObject(context) && (result.push(context));\r\n\t\t});\r\n\t\tthis.routesContext = result;\r\n\t\treturn this.routesContext;\r\n\t},\r\n\t_normalizeRoutesContextRoute(arg, index, config = {}){\r\n\t\tif(arguments.length < 2){\r\n\t\t\tconfig = this.getRoutesConfig();\r\n\t\t}\r\n\t\tlet context = { page: this };\r\n\t\tif(arg == null)\r\n\t\t\treturn;\r\n\t\tif (_.isString(arg)) {\r\n\t\t\t_.extend(context, {route: arg, rawRoute: arg });\r\n\t\t} else if(_.isFunction(arg)) {\r\n\t\t\targ = arg.call(this, this, index);\r\n\t\t\treturn this._normalizeRoutesContextRoute(arg, index);\r\n\t\t} else {\r\n\t\t\t_.extend(context, arg);\r\n\t\t}\r\n\t\tlet name = (_.isString(index) && index) || context.name || context.route || _.uniqueId('route');\r\n\t\tcontext.name = name;\r\n\r\n\t\tif(_.isNumber(index) && context.order == null)\r\n\t\t\tcontext.order = index;\r\n\r\n\t\tif (!context.rawRoute)\r\n\t\t\tcontext.rawRoute = context.route;\r\n\t\t\t\t\r\n\t\tif(config.relative && config.parentContext && config.parentContext.route)\r\n\t\t\tcontext.route = config.parentContext.route + '/' + context.route;\r\n\r\n\t\treturn context;\r\n\t},\r\n\tgetRoutesConfig(){\r\n\t\tlet config = _.extend({ \r\n\t\t\trelative: this.getOption('relativeRoutes', {args: [this]}),\r\n\t\t\tparent: this.parent,\r\n\t\t\tparentContext: this.parent && _.isFunction(this.parent.getMainRouteContext) && this.parent.getMainRouteContext()\r\n\t\t}, this.getOption('routesConfig', {args: [this]}));\r\n\t\t\r\n\t\treturn config;\r\n\t},\r\n\tgetRoutesContexts(opts = {}){\r\n\t\tlet { clone, reverse } = opts;\r\n\t\tlet result = this.routesContext || [];\r\n\t\tif (clone || reverse) result = [].slice.call(result);\r\n\t\tif (reverse) result.reverse();\r\n\t\treturn result;\r\n\t},\r\n\r\n\tgetMainRouteContext(){\r\n\r\n\t\tif(this.mainRouteContext) return this.mainRouteContext;\r\n\t\tthis.mainRouteContext = _(this.getRoutesContexts())\r\n\t\t\t.chain()\r\n\t\t\t.sortBy((a,b) => comparator([ [b,a, c => c.main], [a,b, c => c.order] ]))\r\n\t\t\t.take(1)\r\n\t\t\t.value()[0];\r\n\r\n\t\treturn this.mainRouteContext;\r\n\t}\r\n};\r\n","import _ from 'underscore';\r\nimport { MnObject } from 'bbmn-core';\r\nimport { mix, getOption } from 'bbmn-utils';\r\nimport { StartableMixin }  from 'bbmn-components';\r\n\r\nimport { childrenableMixin } from 'bbmn-mixins';\r\nimport RoutesMixin from './routes-mixin.js';\r\n\r\n\r\n\r\n\r\nconst BasePage = mix(MnObject).with(childrenableMixin, StartableMixin, RoutesMixin);\r\n\r\nexport default BasePage.extend({\r\n\tconstructor(opts = {}){\r\n\t\tBasePage.apply(this, arguments);\r\n\r\n\t\t//root and parent is childrenable options\r\n\t\tthis.mergeOptions(opts, ['root','parent','router','canNotStart','onStart','onBeginStart', 'onBeforeStart', 'onEndStart', 'onStop', 'onBeginStop', 'onBeforeStop', 'onEndStop']);\r\n\r\n\t\t// resides in routes-mixin\r\n\t\tthis.initializeRoutes();\r\n\r\n\t\t// resides in ChildrenableMixin\r\n\t\tthis.initializeChildren();\r\n\t\t\r\n\t\t// resides in routes-mixin\r\n\t\tthis.registerAllRoutes();\r\n\t},\r\n\tgetOption(...args){\r\n\t\treturn getOption(this, ...args);\r\n\t},\r\n\tgetLabel(){\r\n\t\tlet result = this.getOption('label', { args: [this, this.model]});\r\n\t\treturn result;\r\n\t},\r\n\tgetMenuLabel(){\r\n\t\tlet result = this.getOption('menuLabel', { args: [this, this.model], default: this.getLabel()});\r\n\t\treturn result;\r\n\t},\r\n\r\n\tbuildChildOptions(options){\r\n\t\treturn _.extend({\r\n\t\t\troot: this.getRoot(),\r\n\t\t\tparent: this.parent,\r\n\t\t\trouter: this.router,\r\n\t\t}, options);\r\n\t},\r\n\r\n\tgetSiblings(opts = {}){\r\n\r\n\t\tlet parent = this.getParent();\r\n\t\tlet options = _.extend({ exclude: [this] }, opts);\r\n\t\treturn parent && parent.getChildren(options) || [];\r\n\r\n\t},\r\n\t\r\n\tgetHashes(){\r\n\t\tlet parent = this.getParent();\r\n\t\tlet root = this.getRoot();\r\n\r\n\t\treturn {\r\n\t\t\tpath: this.getPathHash(),\r\n\t\t\tthis: this.getHash(),\r\n\t\t\troot: root && root.getHash && root.getHash() || undefined,\r\n\t\t\tparent: parent && parent.getHash && parent.getHash() || undefined,\r\n\t\t\tchildren: this.getChildrenHashes(),\r\n\t\t\tsiblings: this.getSiblingsHashes()\r\n\t\t};\r\n\t},\r\n\tgetPathHash(){\r\n\t\tlet self = this.getHash();\r\n\t\tlet path = [self];\r\n\t\tlet parent = this.getParent();\r\n\t\tif (parent && _.isFunction(parent.getPathHash)) {\r\n\t\t\tpath.unshift(...parent.getPathHash());\r\n\t\t}\r\n\t\treturn path;\r\n\t},\r\n\tgetChildrenHashes(){\r\n\t\treturn this.getChildren({ map: i => i.getHash(), visible: true, });\r\n\t},\r\n\tgetSiblingsHashes(){\r\n\t\treturn this.getSiblings({ map: i => i.getHash(), visible: true, });\r\n\t},\r\n\r\n\tgetRoot(){\r\n\t\tif (this.root === true) {\r\n\t\t\treturn this;\r\n\t\t} else {\r\n\t\t\treturn this.root;\r\n\t\t}\r\n\t},\r\n\tgetAllPages(opts = {}){\r\n\t\t\r\n\t\tlet options = _.extend({}, opts, { includeSelf: true });\r\n\t\tdelete options.map;\r\n\t\tlet pages = this.getRoot().getAllChildren(options);\r\n\r\n\t\tif (_.isFunction(opts.map)) {\r\n\t\t\treturn _(pages).chain().map(opts.map).filter(f => !!f).value();\r\n\t\t} else {\r\n\t\t\treturn pages;\r\n\t\t}\r\n\t},\r\n\r\n\tgetAllHashes(opts = {}){\r\n\t\tlet options = _.extend({ map: i => i.getHash(), visible: true, }, opts);\r\n\t\treturn this.getAllPages(options);\r\n\t},\r\n\r\n\tgetHash(){\r\n\t\tlet context = this.getMainRouteContext();\r\n\r\n\t\tif(!_.isObject(context))\r\n\t\t\treturn;\r\n\r\n\t\tlet parent = this.getParent();\r\n\t\tlet parentCid = parent && parent.cid || undefined;\t\t\r\n\t\treturn {\r\n\t\t\tcid: this.cid,\r\n\t\t\tparentCid,\r\n\t\t\turl: context.route,\r\n\t\t\tlabel: this.getMenuLabel(),\r\n\t\t\torder: this.order,\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t_childFilter(item, index, opts = {}) {\r\n\t\tlet base = BasePage.prototype._childFilter;\r\n\t\tif(base && !base.apply(this, arguments))\r\n\t\t\treturn;\r\n\r\n\t\tlet { visible } = opts;\r\n\r\n\t\tif(visible && (item.visible === false || item.hidden === true))\r\n\t\t\treturn;\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n});\r\n\r\n","import _ from 'underscore';\r\nimport { App } from 'bbmn-components';\r\nimport { historyApi } from '../history/index.js';\r\nimport PageRouter from './page-router.js';\r\nimport Page from './page';\r\nimport { buildByKey } from 'bbmn-utils';\r\nimport { isClass } from 'bbmn-core';\r\n\r\nexport default App.extend({\r\n\tconstructor(){\r\n\t\t\r\n\t\tthis._pages = [];\r\n\r\n\t\tApp.apply(this, arguments);\r\n\t\tthis.on('start', this._buildPages);\r\n\t\tthis.on('pages:ready', this._startHistory);\r\n\t},\r\n\tRouter: PageRouter,\r\n\t_startHistory(){\r\n\t\tif (historyApi.isStarted()) return;\r\n\r\n\t\tlet options = this.getOption('startHistory');\r\n\t\tif(!options) { return; }\r\n\t\tif (options === true) {\r\n\t\t\toptions = { pushState: false };\r\n\t\t} else if (!_.isObject(options)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\t\tthis.triggerMethod('before:history:start', result);\r\n\r\n\t\tvar result = historyApi.start(options);\r\n\r\n\t\tthis.triggerMethod('history:start', result);\r\n\t},\r\n\t_buildPages(){\r\n\t\tthis.triggerMethod('before:pages:ready');\r\n\t\tthis.buildPages();\r\n\t\tthis.triggerMethod('pages:ready');\r\n\t},\r\n\tbuildPages() {\r\n\t\t\r\n\t\tif (this.rootPage instanceof Page) return;\r\n\r\n\t\tthis.router = this.buildRouter();\r\n\r\n\t\tvar RootPage = this.getOption('RootPage');\r\n\t\tif (isClass(RootPage, Page)) {\r\n\t\t\tthis.rootPage = new RootPage({ router: this.router });\r\n\t\t}\r\n\r\n\t},\t\r\n\tbuildRouter(){\r\n\t\tif (this.router instanceof PageRouter) return this.router;\r\n\t\treturn buildByKey(this, 'Router', { ctor: PageRouter });\r\n\t}\r\n});\r\n"],"names":["get","router","opts","key","update","value","result","context","args","getOption","routeArgumentsToObject","route","name","callback","_","isObject","extend","isFunction","uniqueId","isRouterHoldsActions","rawRoute","isRegExp","_routeToRegExp","callbackWrapper","bind","_processCallback","createActionContext","routeContext","fragment","options","rawArgs","_extractParameters","slice","queryString","pop","qs","prepareActionQueryString","prepareActionArguments","routeType","isString","queryStringParser","params","match","res","each","index","substring","isArray","push","concat","toPromise","arg","resolve","Promise","then","Error","reject","getCallbackFunction","executeResult","exception","promise","processCallback","actionContext","asPromise","triggerEvent","shouldTriggerEvent","execute","lastAttempt","error","handleError","handlers","_getHandleContext","some","applyHandler","handler","getHandler","apply","hash","nullable","items","setHandler","reduce","memo","item","getHandleContext","custom","unshift","$","Deferred","constructor","undefined","Router","BbRouter","arguments","call","routes","getInitRoutes","size","addRoutes","controller","approutes","map","_buildRouteContext","registerRouteContext","_storeCreatedContext","isRouteChaining","normalized","chain","_normalizeRoutes","filter","f","doNotReverse","reverse","registered","addRoute","massAdd","c","clone","has","buildRouteContextFromArguments","buildRouteContext","routeContexts","restart","action","handle","event","trigger","paramStringToObject","optionalParam","namedParam","splatParam","escapeRegExp","replace","optional","flags","RegExp","find","cntx","test","historyApi","navigate","loadUrl","history","matchRoot","getFragment","executed","executeHandler","customTest","testHandler","resultContext","findHandler","start","started","BaseRouter","page","contexts","getRoutesContexts","startPage","process","Process","errors","shift","beforePageStart","afterPageStart","previousPage","isStarted","stop","index$5","Base","_initializeChildrenable","parent","root","initializeChildren","_this","_childrenInitialized","children","_children","child","_initializeChild","Child","isKnownCtor","invoked","omit","buildChildOptions","buildChild","prototype","_getChildren","_this2","length","exclude","_childFilter","force","childFilter","indexOf","getChildren","getAllChildren","includeSelf","flatten","method","getParent","ChildrenableMixin","initializeRouter","_buildRoutesContexts","_createRouter","_shouldRegisterAllRoutes","PageRouter","pages","registerPageRoutes","config","getRoutesConfig","_normalizeRoutesContextRoute","routesContext","isNumber","order","relative","parentContext","getMainRouteContext","mainRouteContext","sortBy","a","b","comparator","main","take","BasePage","mix","MnObject","with","childrenableMixin","StartableMixin","RoutesMixin","mergeOptions","initializeRoutes","registerAllRoutes","model","default","getLabel","getRoot","getPathHash","getHash","getChildrenHashes","getSiblingsHashes","self","path","i","visible","getSiblings","getAllPages","parentCid","cid","getMenuLabel","base","hidden","App","_pages","on","_buildPages","_startHistory","pushState","triggerMethod","buildPages","rootPage","Page","buildRouter","RootPage","isClass","buildByKey","ctor"],"mappings":"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"}